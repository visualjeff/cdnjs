"undefined"==typeof XMLSerializer&&(XMLSerializer=require("xmldom").XMLSerializer,document={},document.implementation=new(require("xmldom").DOMImplementation));var JXON=new function(){function e(e){return s.test(e)?null:c.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):isFinite(Date.parse(e))?new Date(e):e}function t(){}function n(e){return null===e?new t:e instanceof Object?e:new e.constructor(e)}function r(t,i,s,c){var d,f,m=l.length,p=t.hasChildNodes(),h=t.hasAttributes(),g=Boolean(2&i),v=0,b="",y=g?{}:!0;if(p)for(var N,S=0;S<t.childNodes.length;S++)N=t.childNodes.item(S),4===N.nodeType?b+=N.nodeValue:3===N.nodeType?b+=N.nodeValue.trim():1!==N.nodeType||N.prefix||l.push(N);var O=l.length,w=e(b);g||!p&&!h||(y=0===i?n(w):{});for(var x=m;O>x;x++)d=l[x].nodeName.toLowerCase(),f=r(l[x],i,s,c),y.hasOwnProperty(d)?(y[d].constructor!==Array&&(y[d]=[y[d]]),y[d].push(f)):(y[d]=f,v++);if(h){for(var C,T=t.attributes.length,z=c?"":a,A=c?{}:y,L=0;T>L;v++,L++)C=t.attributes.item(L),A[z+C.name.toLowerCase()]=e(C.value.trim());c&&(s&&Object.freeze(A),y[u]=A,v-=T-1)}return 3===i||(2===i||1===i&&v>0)&&b?y[o]=w:!g&&0===v&&b&&(y=w),s&&(g||v>0)&&Object.freeze(y),l.length=m,y}function i(e,t,n){var r,l;if(n.constructor===String||n.constructor===Number||n.constructor===Boolean){if(t.appendChild(e.createTextNode(n.toString())),n===n.valueOf())return}else n.constructor===Date&&t.appendChild(e.createTextNode(n.toGMTString()));for(var s in n)if(r=n[s],!(isFinite(s)||r instanceof Function))if(s===o)null!==r&&r!==!0&&t.appendChild(e.createTextNode(r.constructor===Date?r.toGMTString():String(r)));else if(s===u)for(var c in r)t.setAttribute(c,r[c]);else if(s.charAt(0)===a)t.setAttribute(s.slice(1),r);else if(r.constructor===Array)for(var d=0;d<r.length;d++)l=e.createElementNS(r[d]["@xmlns"]||t.namespaceURI,s),i(e,l,r[d]),t.appendChild(l);else l=e.createElementNS((r||{})["@xmlns"]||t.namespaceURI,s),r instanceof Object?i(e,l,r):null!==r&&r!==!0&&l.appendChild(e.createTextNode(r.toString())),t.appendChild(l)}var o="keyValue",u="keyAttributes",a="@",l=[],s=/^\s*$/,c=/^(?:true|false)$/i;t.prototype.toString=function(){return"null"},t.prototype.valueOf=function(){return null},this.build=function(e,t,n,i){var o=arguments.length>1&&"number"==typeof t?3&t:1;return r(e,o,n||!1,arguments.length>3?i:3===o)},this.unbuild=function(e,t,n,r){var o=document.implementation.createDocument(t||null,n||"",r||null);return i(o,o.documentElement||o,e),o},this.stringify=function(e,t,n,r){return(new XMLSerializer).serializeToString(JXON.unbuild(e,t,n,r))}};"undefined"!=typeof module&&(module.exports=JXON);