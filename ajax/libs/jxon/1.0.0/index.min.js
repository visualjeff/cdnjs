"undefined"==typeof XMLSerializer&&(XMLSerializer=require("xmldom").XMLSerializer,document={},document.implementation=new(require("xmldom").DOMImplementation));var JXON=new function(){function e(e){return s.test(e)?null:c.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):isFinite(Date.parse(e))?new Date(e):e}function t(){}function n(e){return null===e?new t:e instanceof Object?e:new e.constructor(e)}function r(t,i,s,c){var d,f,p=l.length,m=t.hasChildNodes(),h=t.hasAttributes(),g=Boolean(2&i),b=0,v="",y=g?{}:!0;if(m)for(var N,S=0;S<t.childNodes.length;S++)N=t.childNodes.item(S),4===N.nodeType?v+=N.nodeValue:3===N.nodeType?v+=N.nodeValue.trim():1!==N.nodeType||N.prefix||l.push(N);var w=l.length,C=e(v);g||!m&&!h||(y=0===i?n(C):{});for(var O=p;w>O;O++)d=l[O].nodeName.toLowerCase(),f=r(l[O],i,s,c),y.hasOwnProperty(d)?(y[d].constructor!==Array&&(y[d]=[y[d]]),y[d].push(f)):(y[d]=f,b++);if(h){for(var T,x=t.attributes.length,z=c?"":u,A=c?{}:y,L=0;x>L;b++,L++)T=t.attributes.item(L),A[z+T.name.toLowerCase()]=e(T.value.trim());c&&(s&&Object.freeze(A),y[a]=A,b-=x-1)}return 3===i||(2===i||1===i&&b>0)&&v?y[o]=C:!g&&0===b&&v&&(y=C),s&&(g||b>0)&&Object.freeze(y),l.length=p,y}function i(e,t,n){var r,l;n instanceof String||n instanceof Number||n instanceof Boolean?t.appendChild(e.createTextNode(n.toString())):n.constructor===Date&&t.appendChild(e.createTextNode(n.toGMTString()));for(var s in n)if(r=n[s],!(isFinite(s)||r instanceof Function))if(s===o)null!==r&&r!==!0&&t.appendChild(e.createTextNode(r.constructor===Date?r.toGMTString():String(r)));else if(s===a)for(var c in r)t.setAttribute(c,r[c]);else if(s.charAt(0)===u)t.setAttribute(s.slice(1),r);else if(r.constructor===Array)for(var d=0;d<r.length;d++)l=e.createElement(s),i(e,l,r[d]),t.appendChild(l);else l=e.createElement(s),r instanceof Object?i(e,l,r):null!==r&&r!==!0&&l.appendChild(e.createTextNode(r.toString())),t.appendChild(l)}var o="keyValue",a="keyAttributes",u="@",l=[],s=/^\s*$/,c=/^(?:true|false)$/i;t.prototype.toString=function(){return"null"},t.prototype.valueOf=function(){return null},this.build=function(e,t,n,i){var o=arguments.length>1&&"number"==typeof t?3&t:1;return r(e,o,n||!1,arguments.length>3?i:3===o)},this.unbuild=function(e){var t=document.implementation.createDocument("","",null);return i(t,t,e),t},this.stringify=function(e){return(new XMLSerializer).serializeToString(JXON.unbuild(e))}};"undefined"!=typeof module&&(module.exports=JXON);