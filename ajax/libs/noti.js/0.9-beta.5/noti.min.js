/**
* noti.js
* https://github.com/j-l-n/noti.js/
*
* @author: j-l-n (https://github.com/j-l-n)
* @version: 0.9-beta.5 (minified)
* @lastModified: 17/10/2014 (DD/MM/YYYY)
*/

(function(e){"use strict";var t;t=function(){var n;if(typeof e.opera!=="undefined"){if(typeof document.hidden!=="undefined"){n=!document.hidden}else if(typeof document.webkitHidden!=="undefined"){n=!document.webkitHidden}}else{n=document.hasFocus()}return n};var n;n={checkSupport:function(){var t;if(e.Notification){t=true}else{t=false}return t},askForPermission:function(){if(n.checkSupport()===true){if(e.Notification.permission==="default"){console.log("Asking for notification permission...");e.Notification.requestPermission(function(){if(e.Notification.permission==="granted"){console.info("Permission for web notifications granted.")}else if(e.Notification.permission==="denied"){console.warn("Permission for web notifications denied.")}})}else if(e.Notification.permission==="granted"){console.info("Permission for web notifications granted.")}else{console.warn("Permission for web notifications denied.")}}},create:function(r){if(typeof r!=="object"){throw new Error("No arguments were passed to function.")}else if(typeof r.title!=="string"||typeof r.message!=="string"){throw new Error("Title or content of notification is undefined.")}var i;i=false;if(r.debug_alwaysFallback===true){i=true}var s,o,u,a,f;s=function(){var e;if(r.changeTitle_interval){e=r.changeTitle_interval*1e3}else{e=1500}var n;n=document.title;var i;i=setInterval(function(){if(t()){clearInterval(i);document.title=n}else{var e;if(document.title===n){if(r.changeTitle_prefix){e=r.changeTitle_prefix+" "+n}else{e=r.title+" - "+n}}else{e=n}document.title=e}},e)};o=function(e,t){var n,r;n=document.createElement("audio");n.preload="auto";r=document.createElement("source");r.type="audio/ogg";r.src=e;n.appendChild(r);r=document.createElement("source");r.type="audio/mpeg";r.src=t;n.appendChild(r);return n};u=function(e){console.log("Closed notification "+e);if(typeof r.callback==="function"){r.callback()}};a=function(n,i,a){s();if(l){var f;f=o(r.oggSoundFile,r.mp3SoundFile);f.onloadeddata=function(){f.play()}}if(r.dontShowAlert){var c;c=false;if(r.dontShowAlert!==true){var h;if(r.showAlertAfter){h=r.showAlertAfter*1e3}else{h=6e4}c=setTimeout(function(){e.focus();alert(n+"\n\n"+i)},h)}var p;p=setInterval(function(){if(t()){if(c!==false){clearTimeout(c)}clearInterval(p);u(a)}},100)}};f=function(n,r){s();var i,o;i=new e.Notification(n,r);o=setInterval(function(){if(t()){i.close();clearInterval(o)}},100);if(typeof e.mozInnerScreenX!=="undefined"){i.onshow=function(){console.log("Showing notification "+i.tag);var e=setTimeout(function(){i.onclose=function(){};i.close();f(n,r)},3700);i.onclose=function(){clearTimeout(e);clearInterval(o);u(i.tag)}}}else{i.onshow=function(){console.log("Showing notification "+i.tag)};i.onclose=function(){clearInterval(o);u(i.tag)}}};var l,c;l=false;c=typeof document.createElement("audio").play;if(c==="function"){if(r.playSound===true){if(r.oggSoundFile&&r.mp3SoundFile){var h,p;h=r.oggSoundFile;p=r.mp3SoundFile;l=true}else if(r.oggSoundFile||r.mp3SoundFile){throw new Error("If sound file should be played during notification, it must be present both in ogg format and in mp3.")}else{throw new Error("No sound file defined.")}}}else{console.warn("Browser does not support HTML5 audio.")}var d,v,m;d=r.title;v=r.message;m=(new Date).getTime();if(n.checkSupport()===true&&i===false){if(e.Notification.permission==="granted"){var g;g={dir:"auto",lang:"de",body:v,tag:m};if(r.icon){NotificationOptions.icon=r.icon}if(l){var y;y=o(r.oggSoundFile,r.mp3SoundFile);y.onloadeddata=function(){f(d,g);y.play()}}else{f(d,g)}}else{console.info("Permission for web notification denied. Falling back to alert.");a(d,v,m)}}else{console.info("Your browser does not support web notifications! Falling back to alert.");a(d,v,m)}return m}};if(n.checkSupport()===true){n.askForPermission()}e.noti=n})(window)
