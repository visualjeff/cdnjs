!function(){var e="object"==typeof module&&module.exports,t=!e&&window,n=function(t){function n(e){for(var t=[],n=Object.keys(e).sort(),r=0;r<n.length;++r){var a=n[r],i=e[a];V(i)||(i=[i]);for(var o=0;o<i.length;++o){var l=i[o];if(!J(l))throw new Ot("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{languageMap:e});t.push({"@value":l,"@language":a.toLowerCase()})}}return t}function r(e,t){if(V(t))for(var n=0;n<t.length;++n)t[n]=r(e,t[n]);else if(H(t))t["@list"]=r(e,t["@list"]);else if(A(t)){Y(t)&&(t["@id"]=e.getName(t["@id"]));for(var a=Object.keys(t).sort(),i=0;i<a.length;++i){var o=a[i];"@id"!==o&&(t[o]=r(e,t[o]))}}return t}function a(e,n,r){if(null===r)return null;var a=E(e,n,{vocab:!0});if("@id"===a)return E(e,r,{base:!0});if("@type"===a)return E(e,r,{vocab:!0,base:!0});var i=t.getContextValue(e,n,"@type");if("@id"===i||"@graph"===a&&J(r))return{"@id":E(e,r,{base:!0})};if("@vocab"===i)return{"@id":E(e,r,{vocab:!0,base:!0})};if(R(a))return r;if(rval={},null!==i)e.namer&&0===i.indexOf("_:")&&(i=e.namer.getName(i)),rval["@type"]=i;else if(J(r)){var o=t.getContextValue(e,n,"@language");null!==o&&(rval["@language"]=o)}return rval["@value"]=r,rval}function i(e,t){var n=[];for(var r in e){var a=e[r];for(var i in a){var s=a[i];if("@type"===i)i=yt;else if(R(i))continue;for(var u=0;u<s.length;++u){var f=s[u],c={};0===r.indexOf("_:")?(c.type="blank node",c.value=t.getName(r)):(c.type="IRI",c.value=r);var d={type:"IRI"};if(d.value=i,H(f))o(f["@list"],t,c,d,n);else{var p=l(f,t);n.push({subject:c,predicate:d,object:p})}}}}return n}function o(e,t,n,r,a){for(var i={type:"IRI",value:vt},o={type:"IRI",value:ht},s={type:"IRI",value:gt},u=0;u<e.length;++u){var f=e[u],c={type:"blank node",value:t.getName()};a.push({subject:n,predicate:r,object:c}),n=c,r=i;var d=l(f,t);a.push({subject:n,predicate:r,object:d}),r=o}a.push({subject:n,predicate:r,object:s})}function l(e,t){var n={};if(X(e)){n.type="literal";var r=e["@value"],a=e["@type"]||null;z(r)?(n.value=r.toString(),n.datatype=a||ut):F(r)?(n.value=r.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),n.datatype=a||ft):U(r)?(n.value=r.toFixed(0),n.datatype=a||ct):"@language"in e?(n.value=r,n.datatype=a||wt,n.language=e["@language"]):(n.value=r,n.datatype=a||dt)}else{var i=A(e)?e["@id"]:e;0===i.indexOf("_:")?(n.type="blank node",n.value=t.getName(i)):(n.type="IRI",n.value=i)}return n}function s(e,t){if("IRI"===e.type&&e.value===gt)return{"@list":[]};if("IRI"===e.type||"blank node"===e.type)return{"@id":e.value};var n={"@value":e.value};if("language"in e)n["@language"]=e.language;else{var r=e.datatype;if(t){if(r===ut)"true"===n["@value"]?n["@value"]=!0:"false"===n["@value"]&&(n["@value"]=!1);else if(M(n["@value"]))if(r===ct){var a=parseInt(n["@value"]);a.toFixed(0)===n["@value"]&&(n["@value"]=a)}else r===ft&&(n["@value"]=parseFloat(n["@value"]));-1===[ut,ct,ft,dt].indexOf(r)&&(n["@type"]=r)}else n["@type"]=r}return n}function u(e,t){for(var n=["subject","predicate","object"],r=0;r<n.length;++r){var a=n[r];if(e[a].type!==t[a].type||e[a].value!==t[a].value)return!1}return e.object.language!==t.object.language?!1:e.object.datatype!==t.object.datatype?!1:!0}function f(e,t){if("hash"in t[e])return t[e].hash;for(var n=t[e].quads,r=[],a=0;a<n.length;++a)r.push(et(n[a],n[a].name?n[a].name.value:null,e));r.sort();var i=t[e].hash=It.hash(r);return i}function c(e,n,r,a,i){function o(i){if(i===v.length)return s=Object.keys(p).sort(),l(0);var u=v[i],c=d(u.subject,e),h=null;if(null!==c?h="p":(c=d(u.object,e),null!==c&&(h="r")),null!==c){var g;g=r.isNamed(c)?r.getName(c):a.isNamed(c)?a.getName(c):f(c,n,r);var y=It.create();y.update(h),y.update(u.predicate.value),y.update(g);var x=y.digest();x in p?p[x].push(c):p[x]=[c]}t.nextTick(function(){o(i+1)})}function l(e){function o(){function s(e){if(e===x.length)return f(!1);var t=x[e];c(t,n,r,g,function(n,r){return n?i(n):(y+=g.getName(t)+"<"+r.hash+">",g=r.pathNamer,null!==d&&y.length>=d.length&&y>d?f(!0):void s(e+1))})}function f(n){!n&&(null===d||d>y)&&(d=y,v=g),h.hasNext()?t.nextTick(function(){o()}):(u.update(d),a=v,l(e+1))}var p=h.next(),g=a.clone(),y="",x=[];for(var m in p){var b=p[m];if(r.isNamed(b)?y+=r.getName(b):(g.isNamed(b)||x.push(b),y+=g.getName(b)),null!==d&&y.length>=d.length&&y>d)return f(!0)}s(0)}if(e===s.length)return i(null,{hash:u.digest(),pathNamer:a});var f=s[e];u.update(f);var d=null,v=null,h=new Permutator(p[f]);t.nextTick(function(){o()})}var s,u=It.create(),p={},v=n[e].quads;t.nextTick(function(){o(0)})}function d(e,t){return"blank node"===e.type&&e.value!==t?e.value:null}function p(e,n,r,a,i,o){if(V(e))for(var l in e)p(e[l],n,r,a,void 0,o);else{if(!A(e))return void(o&&o.push(e));if("@type"in e){var s=e["@type"];V(s)||(s=[s]);for(var u=0;u<s.length;++u){var f=s[u],c=0===f.indexOf("_:")?a.getName(f):f;c in n[r]||(n[r][c]={"@id":c})}}if(X(e))return void(o&&o.push(e));q(i)&&(i=Y(e)?a.getName(e["@id"]):e["@id"]),o&&o.push({"@id":i});var d=n[r],v=d[i]=d[i]||{};v["@id"]=i;for(var h=Object.keys(e).sort(),g=0;g<h.length;++g){var y=h[g];if("@id"!==y)if("@reverse"in e){var x={"@id":i},m=e["@reverse"];for(var b in m)for(var w=m[b],j=0;w>j;++j){var O=w[j];t.addValue(O,b,x,{propertyIsArray:!0}),p(O,n,r,a)}}else if("@graph"!==y)if("@type"!==y&&R(y)){if("@index"===y&&"@index"in v)throw new Ot("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{subject:v});v[y]=e[y]}else{var C=e[y];if(0!==C.length)for(var I=0;I<C.length;++I){var N=C[I];if(P(N)||B(N)){var c=Y(N)?a.getName(N["@id"]):N["@id"];t.addValue(v,y,{"@id":c},{propertyIsArray:!0,allowDuplicate:!1}),p(N,n,r,a,c)}else if(H(N)){var S=[];p(N["@list"],n,r,a,i,S),N={"@list":S},t.addValue(v,y,N,{propertyIsArray:!0,allowDuplicate:!1})}else p(N,n,r,a,i),t.addValue(v,y,N,{propertyIsArray:!0,allowDuplicate:!1})}else t.addValue(v,y,[],{propertyIsArray:!0})}else{i in n||(n[i]={});var E="@merged"===r?r:i;p(e[y],n,E,a)}}}}function v(e,n,r,a,i){g(e,r),r=r[0];var o=y(e,n,r),l=e.options,s=h(r,l,"embed"),u=h(r,l,"explicit"),f=Object.keys(o).sort();for(var c in f){var d=f[c];null===i&&(e.embeds={});var p={};p["@id"]=d;var x={parent:a,property:i};if(s&&d in e.embeds){s=!1;var j=e.embeds[d];if(V(j.parent)){for(var O in j.parent)if(t.compareValues(p,j.parent[O])){s=!0;break}}else t.hasValue(j.parent,j.property,p)&&(s=!0);s&&b(e,d)}if(s){e.embeds[d]=x;var C=o[d],I=Object.keys(C).sort();for(var O in I){var N=I[O];if(R(N))p[N]=G(C[N]);else if(N in r){var S=C[N];for(var O in S){var E=S[O];if(H(E)){var k={"@list":[]};w(e,p,N,k);var D=E["@list"];for(var L in D)E=D[L],B(E)?v(e,[E["@id"]],r[N],k,"@list"):w(e,k,"@list",G(E))}else B(E)?v(e,[E["@id"]],r[N],p,N):w(e,p,N,G(E))}}else u||m(e,C,N,p)}var I=Object.keys(r).sort();for(var O in I){var N=I[O];if(!R(N)){var A=r[N][0],T=h(A,l,"omitDefault");if(!(T||N in p)){var _="@null";"@default"in A&&(_=G(A["@default"])),V(_)||(_=[_]),p[N]=[{"@preserve":_}]}}}w(e,a,i,p)}else w(e,a,i,p)}}function h(e,t,n){var r="@"+n;return r in e?e[r][0]:t[n]}function g(e,t){if(!V(t)||1!==t.length||!A(t[0]))throw new Ot("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:t})}function y(e,t,n){var r={};for(var a in t){var i=t[a],o=e.subjects[i];x(o,n)&&(r[i]=o)}return r}function x(e,n){if("@type"in n&&(1!==n["@type"].length||!A(n["@type"][0]))){var r=n["@type"];for(var a in r)if(t.hasValue(e,"@type",r[a]))return!0;return!1}for(var i in n)if(!("@id"!==i&&R(i)||i in e))return!1;return!0}function m(e,t,n,r){var a=t[n];for(var i in a){var o=a[i];if(H(o)){var l={"@list":[]};return w(e,r,n,l),m(e,o,"@list",l["@list"])}if(B(o)){var s=o["@id"];if(!(s in e.embeds)){var u={parent:r,property:n};e.embeds[s]=u,o={};var f=e.subjects[s];for(var c in f)R(c)?o[c]=G(f[c]):m(e,f,c,o)}w(e,r,n,o)}else w(e,r,n,G(o))}}function b(e,n){var r=e.embeds,a=r[n],i=a.parent,o=a.property,l={"@id":n};if(V(i)){for(var s in i)if(t.compareValues(i[s],l)){i[s]=l;break}}else{var u=V(i[o]);t.removeValue(i,o,l,{propertyIsArray:u}),t.addValue(i,o,l,{propertyIsArray:u})}var f=function(e){var t=Object.keys(r);for(var n in t){var a=t[n];a in r&&A(r[a].parent)&&r[a].parent["@id"]===e&&(delete r[a],f(a))}};f(n)}function w(e,n,r,a){A(n)?t.addValue(n,r,a,{propertyIsArray:!0}):n.push(a)}function j(e,n,r){if(V(n)){var a=[];for(var i in n){var o=j(e,n[i],r);null!==o&&a.push(o)}n=a}else if(A(n)){if("@preserve"in n)return"@null"===n["@preserve"]?null:n["@preserve"];if(X(n))return n;if(H(n))return n["@list"]=j(e,n["@list"],r),n;for(var l in n){var o=j(e,n[l],r),s=t.getContextValue(e,l,"@container");r.compactArrays&&V(o)&&1===o.length&&null===s&&(o=o[0]),n[l]=o}}return n}function O(e,t){return e.length<t.length?-1:t.length<e.length?1:e===t?0:t>e?-1:1}function C(e,t,n,r,a,i){null===i&&(i="@null");var o=[];if("@id"!==i&&"@reverse"!==i||!B(n))o.push(i);else{"@reverse"===i&&o.push("@reverse");var l=I(e,n["@id"],null,{vocab:!0});l in e.mappings&&e.mappings[l]&&e.mappings[l]["@id"]===n["@id"]?o.push.apply(o,["@vocab","@id"]):o.push.apply(o,["@id","@vocab"])}o.push("@none");for(var l=null,s=e.inverse[t],u=0;null===l&&u<r.length;++u){var f=r[u];if(f in s)for(var c=s[f][a],d=0;null===l&&d<o.length;++d){var p=o[d];p in c&&(l=c[p])}}return l}function I(e,t,n,r,a){if(null===t)return t;if(q(n)&&(n=null),q(a)&&(a=!1),r=r||{},R(t)&&(r.vocab=!0),r.vocab&&t in e.getInverse()){var i=e["@language"]||"@none",o=[];A(n)&&"@index"in n&&o.push("@index");var l="@language",s="@null";if(a)l="@type",s="@reverse",o.push("@set");else if(H(n)){"@index"in n||o.push("@list");for(var u=n["@list"],f=0===u.length?i:null,c=null,d=0;d<u.length;++d){var p=u[d],v="@none",h="@none";if(X(p)?"@language"in p?v=p["@language"]:"@type"in p?h=p["@type"]:v="@null":h="@id",null===f?f=v:v!==f&&X(p)&&(f="@none"),null===c?c=h:h!==c&&(c="@none"),"@none"===f&&"@none"===c)break}f=f||"@none",c=c||"@none","@none"!==c?(l="@type",s=c):s=f}else X(n)?"@language"in n&&!("@index"in n)?(o.push("@language"),s=n["@language"]):"@type"in n&&(l="@type",s=n["@type"]):(l="@type",s="@id"),o.push("@set");o.push("@none");var g=C(e,t,n,o,l,s);if(null!==g)return g}var y=null;for(var g in e.mappings)if(-1===g.indexOf(":")){var x=e.mappings[g];if(x&&x["@id"]!==t&&0===t.indexOf(x["@id"])){var m=g+":"+t.substr(x["@id"].length),b=!(m in e.mappings)||null===n&&e.mappings[m]&&e.mappings[m]["@id"]===t;b&&(null===y||O(m,y)<0)&&(y=m)}}if(null!==y)return y;if(!r.vocab)return D(e["@base"],t);if("@vocab"in e){var w=e["@vocab"];if(0===t.indexOf(w)&&t!==w){var j=t.substr(w.length);if(!(j in e.mappings))return j}}return t}function N(e,n,r){if(X(r)){var a=t.getContextValue(e,n,"@type"),i=t.getContextValue(e,n,"@language"),o=t.getContextValue(e,n,"@container"),l="@index"in r&&"@index"!==o;if(!l&&(r["@type"]===a||r["@language"]===i))return r["@value"];var s=Object.keys(r).length,u=1===s||2===s&&"@index"in r&&!l,f="@language"in e,c=J(r["@value"]),d=e.mappings[n]&&null===e.mappings[n]["@language"];if(u&&(!f||!c||d))return r["@value"];var p={};return l&&(p[I(e,"@index")]=r["@index"]),"@type"in r?p[I(e,"@type")]=I(e,r["@type"],null,{vocab:!0}):"@language"in r&&(p[I(e,"@language")]=r["@language"]),p[I(e,"@value")]=r["@value"],p}var v=E(e,n,{vocab:!0}),a=t.getContextValue(e,n,"@type"),h=I(e,r["@id"],null,{vocab:"@vocab"===a});if("@id"===a||"@vocab"===a||"@graph"===v)return h;var p={};return p[I(e,"@id")]=h,p}function S(e,t,n,r){if(n in r){if(r[n])return;throw new Ot("Cyclical context definition detected.","jsonld.CyclicalContext",{context:t,term:n})}if(r[n]=!1,R(n))throw new Ot("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{context:t});e.mappings[n]&&delete e.mappings[n];var a=t[n];if(null===a||A(a)&&null===a["@id"])return e.mappings[n]=null,void(r[n]=!0);if(J(a)){var i=E(e,a,{vocab:!0,base:!0},t,r);if(R(i)&&("@context"===i||"@preserve"===i))throw new Ot("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError");return e.mappings[n]={"@id":i},void(r[n]=!0)}if(!A(a))throw new Ot("Invalid JSON-LD syntax; @context property values must be strings or objects.","jsonld.SyntaxError",{context:t});var o={};if(o.reverse=!1,"@reverse"in a){if("@id"in a||"@type"in a||"@language"in a)throw new Ot("Invalid JSON-LD syntax; a @reverse term definition must not contain @id, @type, or @language.","jsonld.SyntaxError",{context:t});var l=a["@reverse"];if(!J(l))throw new Ot("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{context:t});o["@id"]=E(e,l,{vocab:!0,base:!0},t,r),o["@type"]="@id",o.reverse=!0}else if("@id"in a){var i=a["@id"];if(!J(i))throw new Ot("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{context:t});o["@id"]=E(e,i,{vocab:!0,base:!0},t,r)}else{var s=n.indexOf(":");if(-1!==s){var u=n.substr(0,s);if(u in t&&S(e,t,u,r),e.mappings[u]){var f=n.substr(s+1);o["@id"]=e.mappings[u]["@id"]+f}else o["@id"]=n}else{if(!("@vocab"in e))throw new Ot("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{context:t,term:n});o["@id"]=e["@vocab"]+n}}if("@type"in a){var c=a["@type"];if(!J(c))throw new Ot("Invalid JSON-LD syntax; @context @type values must be strings.","jsonld.SyntaxError",{context:t});"@id"!==c&&(c=E(e,c,{vocab:!0,base:!0},t,r)),o["@type"]=c}if("@container"in a){var d=a["@container"];if("@list"!==d&&"@set"!==d&&"@index"!==d&&"@language"!==d)throw new Ot("Invalid JSON-LD syntax; @context @container value must be one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{context:t});if(o.reverse&&"@index"!==d)throw new Ot("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index.","jsonld.SyntaxError",{context:t});o["@container"]=d}if("@language"in a&&!("@type"in a)){var p=a["@language"];if(null!==p&&!J(p))throw new Ot("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{context:t});null!==p&&(p=p.toLowerCase()),o["@language"]=p}e.mappings[n]=o,r[n]=!0}function E(e,t,n,r,a){if(null===t||R(t))return t;r&&t in r&&a[t]!==!0&&S(e,r,t,a),n=n||{};var i=null;if(n.vocab){var o=e.mappings[t];if(null===o)return null;o&&(i=o["@id"])}if(null===i){var l=t.indexOf(":");if(-1!==l){var s=t.substr(0,l),u=t.substr(l+1);if("_"!==s&&0!==u.indexOf("//")){r&&s in r&&S(e,r,s,a);var o=e.mappings[s];o&&(i=o["@id"]+u)}}}if(null===i&&(i=t),R(i))return i;if($(i)?!r&&0===i.indexOf("_:")&&e.namer&&(i=e.namer.getName(i)):n.vocab&&"@vocab"in e?i=e["@vocab"]+i:n.base&&(i=k(e["@base"],i)),r&&!$(i))throw new Ot("Invalid JSON-LD syntax; a @context value does not expand to an absolute IRI.","jsonld.SyntaxError",{context:r,value:t});return i}function k(e,n){if(-1!==n.indexOf(":"))return n;J(e)&&(e=t.url.parse(e||""));var r=t.url.parse(n),a=e.protocol||"";r.authority?a+="//"+r.authority:""!==e.href&&(a+="//"+e.authority);var i;0===r.pathname.indexOf("/")?i=r.pathname:(i=e.pathname,""!==r.pathname&&(i=i.substr(0,i.lastIndexOf("/")+1),i.length>0&&"/"!==i.substr(-1)&&(i+="/"),i+=r.pathname)),i=it(i,""!==a),r.query&&(i+="?"+r.query),r.hash&&(i+=r.hash);var o=a+i;return""===o&&(o="./"),o}function D(e,n){J(e)&&(e=t.url.parse(e||""));var r="";if(""!==e.href?r+=(e.protocol||"")+"//"+e.authority:n.indexOf("//")&&(r+="//"),0!==n.indexOf(r))return n;for(var a=t.url.parse(n.substr(r.length)),i=e.normalizedPath.split("/"),o=a.normalizedPath.split("/");i.length>0&&o.length>0&&i[0]===o[0];)i.shift(),o.shift();var l="";if(i.length>0){"/"!==e.normalizedPath.substr(-1)&&i.pop();for(var s=0;s<i.length;++s)l+="../"}return l+=o.join("/"),a.query&&(l+="?"+a.query),a.hash&&(l+=a.hash),""===l&&(l="./"),l}function L(e){function n(){var e=this;if(e.inverse)return e.inverse;for(var t=e.inverse={},n=e["@language"]||"@none",a=e.mappings,i=Object.keys(a).sort(O),o=0;o<i.length;++o){var l=i[o],s=a[l];if(null!==s){var u=s["@container"]||"@none",f=s["@id"];V(f)||(f=[f]);for(var c=0;c<f.length;++c){var d=f[c],p=t[d];if(p||(t[d]=p={}),p[u]||(p[u]={"@language":{},"@type":{}}),p=p[u],s.reverse)r(s,l,p["@type"],"@reverse");else if("@type"in s)r(s,l,p["@type"],s["@type"]);else if("@language"in s){var v=s["@language"]||"@null";r(s,l,p["@language"],v)}else r(s,l,p["@language"],n),r(s,l,p["@type"],"@none"),r(s,l,p["@language"],"@none")}}}return t}function r(e,t,n,r){r in n||(n[r]=t)}function a(){var e={};return e["@base"]=this["@base"],e.mappings=G(this.mappings),e.namer=this.namer,e.clone=this.clone,e.share=this.share,e.inverse=null,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]),"@vocab"in this&&(e["@vocab"]=this["@vocab"]),e}function i(){var e={};return e["@base"]=this["@base"],e.mappings=this.mappings,e.namer=null,this.namer&&(e.namer=new nt("_:b")),e.clone=this.clone,e.share=this.share,e.inverse=this.inverse,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]),"@vocab"in this&&(e["@vocab"]=this["@vocab"]),e}var o=null;e.renameBlankNodes&&(o=new nt("_:b"));var l=t.url.parse(e.base||"");return{"@base":l,mappings:{},namer:o,inverse:null,getInverse:n,clone:a,share:i}}function R(e){if(!J(e))return!1;switch(e){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return!0}return!1}function A(e){return"[object Object]"===Object.prototype.toString.call(e)}function T(e){return A(e)&&0===Object.keys(e).length}function V(e){return Array.isArray(e)}function _(e){if(!J(e)&&!T(e)){var t=!1;if(V(e)){t=!0;for(var n in e)if(!J(e[n])){t=!1;break}}if(!t)throw new Ot('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, or an empty object.',"jsonld.SyntaxError",{value:e})}}function J(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)}function U(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function F(e){return U(e)&&-1!==String(e).indexOf(".")}function M(e){return!isNaN(parseFloat(e))&&isFinite(e)}function z(e){return"boolean"==typeof e||"[object Boolean]"===Object.prototype.toString.call(e)}function q(e){return"undefined"==typeof e}function P(e){var t=!1;if(A(e)&&!("@value"in e||"@set"in e||"@list"in e)){var n=Object.keys(e).length;t=n>1||!("@id"in e)}return t}function B(e){return A(e)&&1===Object.keys(e).length&&"@id"in e}function X(e){return A(e)&&"@value"in e}function H(e){return A(e)&&"@list"in e}function Y(e){var t=!1;return A(e)&&(t="@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e)),t}function $(e){return J(e)&&-1!==e.indexOf(":")}function G(e){if(e&&"object"==typeof e){var t=V(e)?[]:{};for(var n in e)t[n]=G(e[n]);return t}return e}function Z(e,t,n,r){var a=Object.keys(t).length;if(V(e)){for(var i in e)Z(e[i],t,n,r);return a<Object.keys(t).length}if(A(e)){for(var o in e)if("@context"===o){var l=e[o];if(V(l))for(var s=l.length,i=0;s>i;++i){var u=l[i];J(u)&&(u=k(r,u),n?(u=t[u],V(u)?(Array.prototype.splice.apply(l,[i,1].concat(u)),i+=u.length,s+=u.length):l[i]=u):u in t||(t[u]=!1))}else J(l)&&(l=k(r,l),n?e[o]=t[l]:l in t||(t[l]=!1))}else Z(e[o],t,n,r);return a<Object.keys(t).length}return!1}function Q(e,t,n){var r=null,a=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,i=t.loadContext,o=function(e,t,n,i,l){if(Object.keys(t).length>jt)return r=new Ot("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{max:jt}),l(r);var s={},u=function(){Z(e,s,!0,i),l(null,e)};Z(e,s,!1,i)||u();var f=[];for(var c in s)if(s[c]===!1){if(!a.test(c))return r=new Ot("Malformed URL.","jsonld.InvalidUrl",{url:c}),l(r);f.push(c)}var d=f.length;for(var p in f)!function(e){if(e in t)return r=new Ot("Cyclical @context URLs detected.","jsonld.ContextUrlError",{url:e}),l(r);var a=G(t);a[e]=!0,n(e,function(t,i,f){if(!r){if(!t&&J(f))try{f=JSON.parse(f)}catch(c){t=c}if(t?t=new Ot("Derefencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, or a non-JSON response.","jsonld.InvalidUrl",{url:e,cause:t}):A(f)||(t=new Ot("Derefencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{url:e,cause:t})),t)return r=t,l(r);"@context"in f||(f={"@context":{}}),o(f,a,n,e,function(t,n){return t?l(t):(s[e]=n["@context"],d-=1,void(0===d&&u()))})}})}(f[p])};o(e,{},i,t.base,n)}function K(e){for(var t="(?:<([^:]+:[^>]*)>)",n="(_:(?:[A-Za-z][A-Za-z0-9]*))",r='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"',a="(?:\\^\\^"+t+")",i="(?:@([a-z]+(?:-[a-z0-9]+)*))",o="(?:"+r+"(?:"+a+"|"+i+")?)",l="[ \\t]+",s="[ \\t]*",f=/(?:\r\n)|(?:\n)|(?:\r)/g,c=new RegExp("^"+s+"$"),d="(?:"+t+"|"+n+")"+l,p=t+l,v="(?:"+t+"|"+n+"|"+o+")"+s,h="(?:\\.|(?:(?:"+t+"|"+n+")"+s+"\\.))",g=new RegExp("^"+s+d+p+v+h+s+"$"),y={},x=e.split(f),m=0,b=0;b<x.length;++b){var w=x[b];if(m++,!c.test(w)){var j=w.match(g);if(null===j)throw new Ot("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:m});var O={};if(O.subject=q(j[1])?{type:"blank node",value:j[2]}:{type:"IRI",value:j[1]},O.predicate={type:"IRI",value:j[3]},q(j[4]))if(q(j[5])){O.object={type:"literal"},q(j[7])?q(j[8])?O.object.datatype=dt:(O.object.datatype=wt,O.object.language=j[8]):O.object.datatype=j[7];var C=j[6].replace(/\\"/g,'"').replace(/\\t/g,"	").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");O.object.value=C}else O.object={type:"blank node",value:j[5]};else O.object={type:"IRI",value:j[4]};var I="@default";if(q(j[9])?q(j[10])||(I=j[10]):I=j[9],I in y){for(var N=!0,S=y[I],E=0;N&&E<S.length;++E)u(S[E],O)&&(N=!1);N&&S.push(O)}else y[I]=[O]}}return y}function W(e){var t=[];for(var n in e)for(var r=e[n],a=0;a<r.length;++a){var i=r[a];"@default"===n&&(n=null),t.push(et(i,n))}return t.sort(),t.join("")}function et(e,t,n){var r=e.subject,a=e.predicate,i=e.object,o=t,l="";if(l+="IRI"===r.type?"<"+r.value+">":n?r.value===n?"_:a":"_:z":r.value,l+=" <"+a.value+"> ","IRI"===i.type)l+="<"+i.value+">";else if("blank node"===i.type)l+=n?i.value===n?"_:a":"_:z":i.value;else{var s=i.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');l+='"'+s+'"',i.datatype===wt?l+="@"+i.language:i.datatype!==dt&&(l+="^^<"+i.datatype+">")}return null!==o&&(l+=0!==o.indexOf("_:")?" <"+o+">":n?" _:g":" "+o),l+=" .\n"}function tt(e){var t={};t["@default"]=[];for(var n=e.getSubjects(),r=0;r<n.length;++r){var a=n[r];if(null!==a){var i=e.getSubjectTriples(a);if(null!==i){var o=i.predicates;for(var l in o)for(var s=o[l].objects,u=0;u<s.length;++u){var f=s[u],c={};c.subject=0===a.indexOf("_:")?{type:"blank node",value:a}:{type:"IRI",value:a},c.predicate={type:"IRI",value:l};var d=f.value;if(f.type===mt){lt||rt();var p=new lt;d="";for(var v=0;v<f.value.length;v++)f.value[v].nodeType===st.ELEMENT_NODE?d+=p.serializeToString(f.value[v]):f.value[v].nodeType===st.TEXT_NODE&&(d+=f.value[v].nodeValue)}c.object={},f.type===bt?c.object.type=0===f.value.indexOf("_:")?"blank node":"IRI":(c.object.type="literal",f.type===xt?f.language?(c.object.datatype=wt,c.object.language=f.language):c.object.datatype=dt:c.object.datatype=f.type),c.object.value=d,t["@default"].push(c)}}}}return t}function nt(e){this.prefix=e,this.counter=0,this.existing={}}function rt(){lt=require("xmldom").XMLSerializer}function at(e){if(-1!==e.href.indexOf(":")||0!==e.href.indexOf("//")||e.host)e.authority=e.host||"",e.auth&&(e.authority=e.auth+"@"+e.authority);else{e.pathname=e.pathname.substr(2);var t=e.pathname.indexOf("/");-1===t?(e.authority=e.pathname,e.pathname=""):(e.authority=e.pathname.substr(0,t),e.pathname=e.pathname.substr(t))}}function it(e,t){var n="";0===e.indexOf("/")&&(n="/");for(var r=e.split("/"),a=[];r.length>0;)"."===r[0]||""===r[0]&&r.length>1?r.shift():".."!==r[0]?a.push(r.shift()):(r.shift(),t||a.length>0&&".."!==a[a.length-1]?a.pop():a.push(".."));return n+a.join("/")}t.compact=function(e,n,r,a){function i(e,t,r,i){if(e)return a(e);i.compactArrays&&!i.graph&&V(t)?1===t.length?t=t[0]:0===t.length&&(t={}):i.graph&&A(t)&&(t=[t]),A(n)&&"@context"in n&&(n=n["@context"]),n=G(n),V(n)||(n=[n]);var o=n;n=[];for(var l in o)(!A(o[l])||Object.keys(o[l]).length>0)&&n.push(o[l]);var s=n.length>0;if(1===n.length&&(n=n[0]),s||i.graph)if(V(t)){var u=I(r,"@graph"),f=t;t={},s&&(t["@context"]=n),t[u]=f}else if(A(t)){var f=t;t={"@context":n};for(var c in f)t[c]=f[c]}a(null,t,r)}if("function"==typeof r&&(a=r,r={}),null===e)return a(null,null);"base"in r||(r.base=""),"strict"in r||(r.strict=!0),"compactArrays"in r||(r.compactArrays=!0),"graph"in r||(r.graph=!1),"skipExpansion"in r||(r.skipExpansion=!1),"loadContext"in r||(r.loadContext=t.loadContext);var o=function(e,n,r){return n.skipExpansion?r(null,e):void t.expand(e,n,r)};o(e,r,function(e,o){if(e)return a(new Ot("Could not expand input before compaction.","jsonld.CompactError",{cause:e}));var l=L(r);t.processContext(l,n,r,function(e,t){if(e)return a(new Ot("Could not process context before compaction.","jsonld.CompactError",{cause:e}));try{var n=(new Ct).compact(t,null,o,r);i(null,n,t,r)}catch(l){a(l)}})})},t.expand=function(e){var n,r={},a=1;arguments.length>2&&(r=arguments[1]||{},a+=1),n=arguments[a],"base"in r||(r.base=""),"loadContext"in r||(r.loadContext=t.loadContext),"renameBlankNodes"in r||(r.renameBlankNodes=!0),"keepFreeFloatingNodes"in r||(r.keepFreeFloatingNodes=!1),e=G(e),Q(e,r,function(e,t){if(e)return n(e);try{var a=L(r),i=(new Ct).expand(a,null,t,r,!1);A(i)&&"@graph"in i&&1===Object.keys(i).length?i=i["@graph"]:null===i&&(i=[]),V(i)||(i=[i]),n(null,i)}catch(o){n(o)}})},t.flatten=function(e,n,r,a){"function"==typeof r&&(a=r,r={}),"base"in r||(r.base=""),"loadContext"in r||(r.loadContext=t.loadContext),t.expand(e,r,function(e,i){if(e)return a(new Ot("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));try{var o=(new Ct).flatten(i)}catch(l){return a(l)}return null===n?a(null,o):(r.graph=!0,r.skipExpansion=!0,void t.compact(o,n,r,function(e,t){return e?a(new Ot("Could not compact flattened output.","jsonld.FlattenError",{cause:e})):void a(null,t)}))})},t.frame=function(e,n){var r={},a=2;arguments.length>3&&(r=arguments[2]||{},a+=1);var i=arguments[a];"base"in r||(r.base=""),"loadContext"in r||(r.loadContext=t.loadContext),"embed"in r||(r.embed=!0),r.explicit=r.explicit||!1,r.omitDefault=r.omitDefault||!1;var o=n["@context"]||{};t.expand(e,r,function(e,a){if(e)return i(new Ot("Could not expand input before framing.","jsonld.FrameError",{cause:e}));var l=G(r);l.keepFreeFloatingNodes=!0,t.expand(n,l,function(e,n){if(e)return i(new Ot("Could not expand frame before framing.","jsonld.FrameError",{cause:e}));try{var s=(new Ct).frame(a,n,r)}catch(u){return i(u)}l.graph=!0,l.skipExpansion=!0,t.compact(s,o,l,function(e,t,n){if(e)return i(new Ot("Could not compact framed output.","jsonld.FrameError",{cause:e}));var r=I(n,"@graph");t[r]=j(n,t[r],l),i(null,t)})})})},t.objectify=function(e,n){var r={},a=2;arguments.length>3&&(r=arguments[2]||{},a+=1);var i=arguments[a];"base"in r||(r.base=""),"loadContext"in r||(r.loadContext=t.loadContext),t.expand(e,r,function(e,a){if(e)return i(new Ot("Could not expand input before framing.","jsonld.FrameError",{cause:e}));try{var o=(new Ct).flatten(a)}catch(l){return i(l)}r.graph=!0,r.skipExpansion=!0,t.compact(o,n,r,function(e,n,a){if(e)return i(new Ot("Could not compact flattened output.","jsonld.FrameError",{cause:e}));var o=I(a,"@graph");n[o]=j(a,n[o],r);var l=n[o][0],s=function(e){if(A(e)||V(e)){if(A(e)){if(s.visited[e["@id"]])return;s.visited[e["@id"]]=!0}for(var n in e){var r=e[n],i="@id"===t.getContextValue(a,n,"@type");if(V(r)||A(r)||i)if(J(r)&&i)e[n]=r=l[r],s(r);else if(V(r))for(var o=0;o<r.length;o++)J(r[o])&&i?r[o]=l[r[o]]:A(r[o])&&"@id"in r[o]&&(r[o]=l[r[o]["@id"]]),s(r[o]);else if(A(r)){var u=r["@id"];e[n]=r=l[u],s(r)}}}};s.visited={},s(l),n.of_type={};for(var u in l)if("@type"in l[u]){var f=l[u]["@type"];V(f)||(f=[f]);for(var c in f)f[c]in n.of_type||(n.of_type[f[c]]=[]),n.of_type[f[c]].push(l[u])}i(null,n)})})},t.normalize=function(e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},"base"in n||(n.base=""),"loadContext"in n||(n.loadContext=t.loadContext);var a=G(n);delete a.format,t.toRDF(e,a,function(e,t){return e?r(new Ot("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:e})):void(new Ct).normalize(t,n,r)})},t.fromRDF=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},"useRdfType"in t||(t.useRdfType=!1),"useNativeTypes"in t||(t.useNativeTypes=!0),"format"in t||!J(e)||"format"in t||(t.format="application/nquads"),t.format){if(!(t.format in ot))throw new Ot("Unknown input format.","jsonld.UnknownFormat",{format:t.format});e=ot[t.format](e)}(new Ct).fromRDF(e,t,n)},t.toRDF=function(e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},"base"in n||(n.base=""),"loadContext"in n||(n.loadContext=t.loadContext),t.expand(e,n,function(e,t){if(e)return r(new Ot("Could not expand input before conversion to RDF.","jsonld.RdfError",{cause:e}));var a=new nt("_:b"),i={"@default":{}};p(t,i,"@default",a);try{var o=Ct.prototype.toRDF(i);if(n.format){if("application/nquads"===n.format)return r(null,W(o));throw new Ot("Unknown output format.","jsonld.UnknownFormat",{format:n.format})}r(null,o)}catch(l){r(l)}})},t.relabelBlankNodes=function(e){r(new nt("_:b",e))},t.loadContext=function(e,t){return t(new Ot("Could not retrieve @context URL. URL derefencing not implemented.","jsonld.ContextUrlError"),e)},t.nextTick="undefined"!=typeof process&&process.nextTick?process.nextTick:"function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){setTimeout(e,0)},t.ContextCache=function(e){this.order=[],this.cache={},this.size=e||50,this.expires=18e5},t.ContextCache.prototype.get=function(e){if(e in this.cache){var t=this.cache[e];if(t.expires>=+new Date)return t.ctx;delete this.cache[e],this.order.splice(this.order.indexOf(e),1)}return null},t.ContextCache.prototype.set=function(e,t){this.order.length===this.size&&delete this.cache[this.order.shift()],this.order.push(e),this.cache[e]={ctx:t,expires:+new Date+this.expires}},t.ActiveContextCache=function(e){this.order=[],this.cache={},this.size=e||100},t.ActiveContextCache.prototype.get=function(e,t){var n=JSON.stringify(e),r=JSON.stringify(t),a=this.cache[n];return a&&r in a?a[r].share():null},t.ActiveContextCache.prototype.set=function(e,t,n){if(this.order.length===this.size){var r=this.order.shift();delete this.cache[r.activeCtx][r.localCtx]}var a=JSON.stringify(e),i=JSON.stringify(t);this.order.push({activeCtx:a,localCtx:i}),a in this.cache||(this.cache[a]={}),this.cache[a][i]=n},t.cache={activeCtx:new t.ActiveContextCache},t.contextLoaders={},t.contextLoaders.jquery=function(e,n){n=n||{};var r=new t.ContextCache;return function(t,a){if(n.secure&&0!==t.indexOf("https"))return a(new Ot('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{url:t}),t);var i=r.get(t);return null!==i?a(null,t,i):void e.ajax({url:t,dataType:"json",crossDomain:!0,success:function(e){r.set(t,e),a(null,t,e)},error:function(e,n,r){a(new Ot("URL could not be dereferenced, an error occurred.","jsonld.LoadContextError",{url:t,cause:r}),t)}})}},t.contextLoaders.node=function(e){function n(t,l,s){if(e.secure&&0!==t.indexOf("https"))return s(new Ot('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{url:t}),t);var u=o.get(t);return null!==u?s(null,t,u):void a({url:t,strictSSL:!0,followRedirect:!1},function(e,a,u){if(e)return s(new Ot("URL could not be dereferenced, an error occurred.","jsonld.LoadContextError",{url:t,cause:e}),t);var f=i.STATUS_CODES[a.statusCode];if(a.statusCode>=400)return s(new Ot("URL could not be dereferenced: "+f,"jsonld.InvalidUrl",{url:t,httpStatusCode:a.statusCode}),t);
if(a.statusCode>=300&&a.statusCode<400&&a.headers.location)return l.length===r?s(new Ot("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{url:t,httpStatusCode:a.statusCode,redirects:l}),t):-1!==l.indexOf(t)?s(new Ot("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{url:t,httpStatusCode:a.statusCode,redirects:l}),t):(l.push(t),n(a.headers.location,l,s));l.push(t);for(var c=0;c<l.length;++c)o.set(l[c],u);s(e,t,u)})}e=e||{};var r="maxRedirects"in e?e.maxRedirects:-1,a=require("request"),i=require("http"),o=new t.ContextCache;return function(e,t){n(e,[],t)}},t.useContextLoader=function(e){if(!(e in t.contextLoaders))throw new Ot('Unknown @context loader type: "'+e+'"',"jsonld.UnknownContextLoader",{type:e});t.loadContext=t.contextLoaders[e].apply(t,Array.prototype.slice.call(arguments,1))},t.processContext=function(e,n){var r={},a=2;arguments.length>3&&(r=arguments[2]||{},a+=1);var i=arguments[a];return"base"in r||(r.base=""),"loadContext"in r||(r.loadContext=t.loadContext),null===n?i(null,L(r)):(n=G(n),!A(n)||"@context"in n||(n={"@context":n}),void Q(n,r,function(t,n){if(t)return i(t);try{n=(new Ct).processContext(e,n,r),i(null,n)}catch(a){i(a)}}))},t.hasProperty=function(e,t){var n=!1;if(t in e){var r=e[t];n=!V(r)||r.length>0}return n},t.hasValue=function(e,n,r){var a=!1;if(t.hasProperty(e,n)){var i=e[n],o=H(i);if(V(i)||o){o&&(i=i["@list"]);for(var l in i)if(t.compareValues(r,i[l])){a=!0;break}}else V(r)||(a=t.compareValues(r,i))}return a},t.addValue=function(e,n,r,a){if(a=a||{},"propertyIsArray"in a||(a.propertyIsArray=!1),"allowDuplicate"in a||(a.allowDuplicate=!0),V(r)){0!==r.length||!a.propertyIsArray||n in e||(e[n]=[]);for(var i in r)t.addValue(e,n,r[i],a)}else if(n in e){var o=!a.allowDuplicate&&t.hasValue(e,n,r);V(e[n])||o&&!a.propertyIsArray||(e[n]=[e[n]]),o||e[n].push(r)}else e[n]=a.propertyIsArray?[r]:r},t.getValues=function(e,t){var n=e[t]||[];return V(n)||(n=[n]),n},t.removeProperty=function(e,t){delete e[t]},t.removeValue=function(e,n,r,a){a=a||{},"propertyIsArray"in a||(a.propertyIsArray=!1);var i=t.getValues(e,n).filter(function(e){return!t.compareValues(e,r)});0===i.length?t.removeProperty(e,n):e[n]=1!==i.length||a.propertyIsArray?i:i[0]},t.compareValues=function(e,n){if(e===n)return!0;if(X(e)&&X(n)&&e["@value"]===n["@value"]&&e["@type"]===n["@type"]&&e["@language"]===n["@language"]&&e["@index"]===n["@index"])return!0;if(H(e)&&H(n)){if(e["@index"]!==n["@index"])return!1;var r=e["@list"],a=n["@list"];if(r.length!==a.length)return!1;for(var i=0;i<r.length;++i)if(!t.compareValues(r[i],a[i]))return!1;return!0}return A(e)&&"@id"in e&&A(n)&&"@id"in n?e["@id"]===n["@id"]:!1},t.getContextValue=function(e,t,n){var r=null;if(null===t)return r;if("@language"===n&&n in e&&(r=e[n]),e.mappings[t]){var a=e.mappings[t];q(n)?r=a:n in a&&(r=a[n])}return r};var ot={};if(t.registerRDFParser=function(e,t){ot[e]=t},t.unregisterRDFParser=function(e){delete ot[e]},e){if("undefined"==typeof lt)var lt=null;if("undefined"==typeof st)var st={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}var ut="http://www.w3.org/2001/XMLSchema#boolean",ft="http://www.w3.org/2001/XMLSchema#double",ct="http://www.w3.org/2001/XMLSchema#integer",dt="http://www.w3.org/2001/XMLSchema#string",pt="http://www.w3.org/1999/02/22-rdf-syntax-ns#",vt=pt+"first",ht=pt+"rest",gt=pt+"nil",yt=pt+"type",xt=pt+"PlainLiteral",mt=pt+"XMLLiteral",bt=pt+"object",wt=pt+"langString",jt=10,Ot=function(t,n,r){e&&(Error.call(this),Error.captureStackTrace(this,this.constructor)),this.name=n||"jsonld.Error",this.message=t||"An unspecified JSON-LD error occurred.",this.details=r||{}};e&&require("util").inherits(Ot,Error);var Ct=function(){};Ct.prototype.compact=function(e,n,r,a){if(V(r)){var i=[];for(var o in r){var l=this.compact(e,n,r[o],a);null!==l&&i.push(l)}if(a.compactArrays&&1===i.length){var s=t.getContextValue(e,n,"@container");null===s&&(i=i[0])}return i}if(A(r)){if(X(r)||B(r))return N(e,n,r);for(var u="@reverse"===n,f=Object.keys(r).sort(),i={},c=0;c<f.length;++c){var d=f[c],p=r[d];if("@id"!==d&&"@type"!==d)if("@reverse"!==d)if("@index"!==d){if(0===p.length){var v=I(e,d,p,{vocab:!0},u);t.addValue(i,v,p,{propertyIsArray:!0})}for(var h=0;h<p.length;++h){var g=p[h],v=I(e,d,g,{vocab:!0},u),s=t.getContextValue(e,v,"@container"),y=H(g),x=null;y&&(x=g["@list"]);var m=this.compact(e,v,y?x:g,a);if(y)if(V(m)||(m=[m]),"@list"!==s){var b={};b[I(e,"@list")]=m,m=b,"@index"in g&&(m[I(e,"@index")]=g["@index"])}else if(v in i)throw new Ot('JSON-LD compact error; property has a "@list" @container rule but there is more than a single @list that matches the compacted term in the document. Compaction might mix unwanted items into the list.',"jsonld.SyntaxError");if("@language"===s||"@index"===s){var w;v in i?w=i[v]:i[v]=w={},"@language"===s&&X(m)&&(m=m["@value"]),t.addValue(w,g[s],m)}else{var j=!a.compactArrays||"@set"===s||"@list"===s||V(m)&&0===m.length||"@list"===d||"@graph"===d;t.addValue(i,v,m,{propertyIsArray:j})}}}else{var s=t.getContextValue(e,n,"@container");if("@index"===s)continue;var O=I(e,d);t.addValue(i,O,p)}else{var C=this.compact(e,"@reverse",p,a);for(var S in C)e.mappings[S]&&e.mappings[S].reverse&&(S in i||a.compactArrays||(i[S]=[]),t.addValue(i,S,C[S]),delete C[S]);if(Object.keys(C).length>0){var O=I(e,d);t.addValue(i,O,C)}}else{var C;if(J(p))C=I(e,p,null,{vocab:"@type"===d});else{C=[];for(var h=0;h<p.length;++h)C.push(I(e,p[h],null,{vocab:!0}))}var O=I(e,d),j=V(C)&&0===p.length;t.addValue(i,O,C,{propertyIsArray:j})}}return i}return r},Ct.prototype.expand=function(e,r,i,o,l){var s=this;if("undefined"==typeof i)throw new Ot("Invalid JSON-LD syntax; undefined element.","jsonld.SyntaxError");if(null===i)return null;if(V(i)){var u=[];for(var f in i){var c=s.expand(e,r,i[f],o,l);if(l&&(V(c)||H(c)))throw new Ot("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError");null!==c&&(V(c)?u=u.concat(c):u.push(c))}return u}if(A(i)){"@context"in i&&(e=s.processContext(e,i["@context"],o));for(var d=E(e,r,{vocab:!0}),u={},p=Object.keys(i).sort(),v=0;v<p.length;++v){var h,g=p[v],y=i[g];if("@context"!==g){var x=E(e,g,{vocab:!0});if(null!==x&&($(x)||R(x))){if(R(x)&&"@reverse"===d)throw new Ot("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{value:y});if("@id"===x&&!J(y))throw new Ot('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{value:y});if("@type"===x&&_(y),"@graph"===x&&!A(y)&&!V(y))throw new Ot('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{value:y});if("@value"===x&&(A(y)||V(y)))throw new Ot('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{value:y});if("@language"===x){if(!J(y))throw new Ot('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{value:y});y=y.toLowerCase()}if("@index"===x&&!J(y))throw new Ot('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{value:y});if("@reverse"!==x){var m=t.getContextValue(e,g,"@container");if("@language"===m&&A(y))h=n(y);else if("@index"===m&&A(y))h=function(t){for(var n=[],r=Object.keys(y).sort(),a=0;a<r.length;++a){var i=r[a],l=y[i];V(l)||(l=[l]),l=s.expand(e,t,l,o,!1);for(var u=0;u<l.length;++u){var f=l[u];"@index"in f||(f["@index"]=i),n.push(f)}}return n}(g);else{var b="@list"===x;if(b||"@set"===x){var w=r;if(b&&"@graph"===d&&(w=null),h=s.expand(e,w,y,o,b),b&&H(h))throw new Ot("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError")}else h=s.expand(e,g,y,o,!1)}if(null!==h||"@value"===x)if("@list"===x||H(h)||"@list"!==m||(h=V(h)?h:[h],h={"@list":h}),e.mappings[g]&&e.mappings[g].reverse){var j=u["@reverse"]={};V(h)||(h=[h]);for(var O=0;O<h.length;++O){var C=h[O];if(X(C)||H(C))throw new Ot('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{value:h});t.addValue(j,x,C,{propertyIsArray:!0})}}else{var I=-1===["@index","@id","@type","@value","@language"].indexOf(x);t.addValue(u,x,h,{propertyIsArray:I})}}else{if(!A(y))throw new Ot('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{value:y});if(h=s.expand(e,"@reverse",y,o,l),"@reverse"in h)for(var N in h["@reverse"])t.addValue(u,N,h["@reverse"][N],{propertyIsArray:!0});var j=u["@reverse"]||null;for(var N in h)if("@reverse"!==N){null===j&&(j=u["@reverse"]={}),t.addValue(j,N,[],{propertyIsArray:!0});for(var S=h[N],O=0;O<S.length;++O){var C=S[O];if(X(C)||H(C))throw new Ot('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{value:h});t.addValue(j,N,C,{propertyIsArray:!0})}}}}}}p=Object.keys(u);var k=p.length;if("@value"in u){if("@type"in u&&"@language"in u)throw new Ot('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and "@language".',"jsonld.SyntaxError",{element:u});var D=k-1;if("@type"in u&&(D-=1),"@index"in u&&(D-=1),"@language"in u&&(D-=1),0!==D)throw new Ot('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and at most one other property which can be "@type" or "@language".',"jsonld.SyntaxError",{element:u});null===u["@value"]?u=null:"@language"in u&&!J(u["@value"])&&delete u["@language"]}else if("@type"in u&&!V(u["@type"]))u["@type"]=[u["@type"]];else if("@set"in u||"@list"in u){if(k>1&&2!==k&&"@index"in u)throw new Ot('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{element:u});"@set"in u&&(u=u["@set"],p=Object.keys(u),k=p.length)}else 1===k&&"@language"in u&&(u=null);if(A(u)&&!o.keepFreeFloatingNodes&&!l&&(null===r||"@graph"===d))if(0===k||"@value"in u)u=null;else{for(var L=!1,T=["@graph","@type"],v=0;!L&&v<p.length;++v)R(p[v])&&-1===T.indexOf(p[v])||(L=!0);L||(u=null)}return u}return l||null!==r&&"@graph"!==E(e,r,{vocab:!0})?a(e,r,i):null},Ct.prototype.flatten=function(e){var t=new nt("_:b"),n={"@default":{}};p(e,n,"@default",t);for(var r=n["@default"],a=Object.keys(n).sort(),i=0;i<a.length;++i){var o=a[i];if("@default"!==o){var l=n[o],s=r[o];s?"@graph"in s||(s["@graph"]=[]):r[o]=s={"@id":o,"@graph":[]};for(var u=s["@graph"],f=Object.keys(l).sort(),c=0;c<f.length;++c){var d=f[c];u.push(l[d])}}}for(var v=[],h=Object.keys(r).sort(),g=0;g<h.length;++g){var y=h[g];v.push(r[y])}return v},Ct.prototype.frame=function(e,t,n){var r={options:n,graphs:{"@default":{},"@merged":{}}};namer=new nt("_:b"),p(e,r.graphs,"@merged",namer),r.subjects=r.graphs["@merged"];var a=[];return v(r,Object.keys(r.subjects).sort(),t,a,null),a},Ct.prototype.normalize=function(e,n,r){function a(e){function n(l){if(l===e.length)return i(o,a,r);var s=e[l],c=f(s,u,b);c in a?(a[c].push(s),r.push(s)):c in o?(a[c]=[o[c],s],r.push(o[c]),r.push(s),delete o[c]):o[c]=s,t.nextTick(function(){n(l+1)})}var r=[],a={},o={};t.nextTick(function(){n(0)})}function i(e,t,n){for(var r=!1,i=Object.keys(e).sort(),l=0;l<i.length;++l){var s=e[i[l]];b.getName(s),r=!0}r?a(n):o(t)}function o(e){function t(a){function i(e,n){if(n===e.length){s.sort(function(e,t){return e=e.hash,t=t.hash,t>e?-1:e>t?1:0});for(var o in s)for(var l in s[o].pathNamer.existing)b.getName(l);return t(a+1)}var f=e[n];if(b.isNamed(f))return i(e,n+1);var d=new nt("_:b");d.getName(f),c(f,u,b,d,function(t,a){return t?r(t):(s.push(a),void i(e,n+1))})}if(a===n.length)return l();var o=e[n[a]],s=[];i(o,0)}var n=Object.keys(e).sort();t(0)}function l(){for(var e=[],t=0;t<s.length;++t){for(var a=s[t],i=["subject","object","name"],o=0;o<i.length;++o){var l=i[o];a[l]&&"blank node"===a[l].type&&0!==a[l].value.indexOf("_:c14n")&&(a[l].value=b.getName(a[l].value))}e.push(et(a,a.name?a.name.value:null))}return e.sort(),n.format?"application/nquads"===n.format?r(null,e.join("")):r(new Ot("Unknown output format.","jsonld.UnknownFormat",{format:n.format})):void r(null,K(e.join("")))}var s=[],u={};for(var d in e){var p=e[d];"@default"===d&&(d=null);for(var v=0;v<p.length;++v){var h=p[v];null!==d&&(h.name=0===d.indexOf("_:")?{type:"blank node",value:d}:{type:"IRI",value:d}),s.push(h);for(var g=["subject","object","name"],y=0;y<g.length;++y){var x=g[y];if(h[x]&&"blank node"===h[x].type){var m=h[x].value;m in u?u[m].quads.push(h):u[m]={quads:[h]}}}}}var b=new nt("_:c14n");return a(Object.keys(u))},Ct.prototype.fromRDF=function(e,n,r){var a={subjects:{},listMap:{}},i={"@default":a};for(var o in e)for(var l=e[o],u=0;u<l.length;++u){var f,c=l[u],d=c.subject.value,p=c.predicate.value,v=c.object;if(f=o in i?i[o]:i[o]={subjects:{},listMap:{}},p!==vt){if(p!==ht){"@default"===o||o in a.subjects||(a.subjects[o]={"@id":o});var h,g=f.subjects;if(h=d in g?g[d]:g[d]={"@id":d},p!==yt||n.useRdfType){var y=s(v,n.useNativeTypes);if(t.addValue(h,p,y,{propertyIsArray:!0}),"blank node"===v.type){var x,m=y["@id"],b=f.listMap;x=m in b?b[m]:b[m]={},x.head=y}}else t.addValue(h,"@type",v.value,{propertyIsArray:!0})}else if("blank node"===v.type){var x,b=f.listMap;x=d in b?b[d]:b[d]={},x.rest=v.value}}else{var x,b=f.listMap;x=d in b?b[d]:b[d]={},x.first=s(v,n.useNativeTypes)}}for(var o in i){var f=i[o],b=f.listMap;for(var w in b){var x=b[w];if("head"in x&&"first"in x){delete x.head["@id"];for(var j=x.head["@list"]=[x.first];"rest"in x;){var O=x.rest;if(x=b[O],!("first"in x))throw new Ot("Invalid RDF list entry.","jsonld.RdfError",{bnode:O});j.push(x.first)}}}}for(var C=[],g=a.subjects,I=Object.keys(g).sort(),N=0;N<I.length;++N){var m=I[N],w=g[m];if(C.push(w),m in i)for(var f=w["@graph"]=[],S=i[m].subjects,E=Object.keys(S).sort(),k=0;k<E.length;++k)f.push(S[E[k]])}r(null,C)},Ct.prototype.toRDF=function(e){var t=new nt("_:b"),n={};for(var r in e){var a=e[r];0===r.indexOf("_:")&&(r=t.getName(r)),n[r]=i(a,t)}return n},Ct.prototype.processContext=function(e,n,r){var a=null;if(t.cache.activeCtx&&(a=t.cache.activeCtx.get(e,n)))return a.namer=e.namer,a;a=e.clone(),A(n)&&"@context"in n&&V(n["@context"])&&(n=n["@context"]);var i=V(n)?n:[n];for(var o in i){var l=i[o];if(null!==l){if(A(l)&&"@context"in l&&(l=l["@context"]),!A(l))throw new Ot("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{context:l});var s={};if("@base"in l){var u=l["@base"];if(null===u)u=r.base;else{if(!J(u))throw new Ot('Invalid JSON-LD syntax; the value of "@base" in a @context must be a string or null.',"jsonld.SyntaxError",{context:l});if(""!==u&&!$(u))throw new Ot('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI or the empty string.',"jsonld.SyntaxError",{context:l})}u=t.url.parse(u||""),a["@base"]=u,s["@base"]=!0}if("@vocab"in l){var f=l["@vocab"];if(null===f)delete a["@vocab"];else{if(!J(f))throw new Ot('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{context:l});if(!$(f))throw new Ot('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{context:l});a["@vocab"]=f}s["@vocab"]=!0}if("@language"in l){var f=l["@language"];if(null===f)delete a["@language"];else{if(!J(f))throw new Ot('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{context:l});a["@language"]=f.toLowerCase()}s["@language"]=!0}for(var c in l)S(a,l,c,s)}else a=L(r),a.namer=e.namer}return t.cache.activeCtx&&t.cache.activeCtx.set(e,n,a),a},Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),t.registerRDFParser("application/nquads",K),t.registerRDFParser("rdfa-api",tt),nt.prototype.clone=function(){var e=new nt(this.prefix);return e.counter=this.counter,e.existing=G(this.existing),e},nt.prototype.getName=function(e){if(e&&e in this.existing)return this.existing[e];var t=this.prefix+this.counter;return this.counter+=1,e&&(this.existing[e]=t),t},nt.prototype.isNamed=function(e){return e in this.existing},Permutator=function(e){this.list=e.sort(),this.done=!1,this.left={};for(var t in e)this.left[e[t]]=!0},Permutator.prototype.hasNext=function(){return!this.done},Permutator.prototype.next=function(){for(var e=this.list.slice(),t=null,n=0,r=this.list.length,a=0;r>a;++a){var i=this.list[a],o=this.left[i];(null===t||i>t)&&(o&&a>0&&i>this.list[a-1]||!o&&r-1>a&&i>this.list[a+1])&&(t=i,n=a)}if(null===t)this.done=!0;else{var l=this.left[t]?n-1:n+1;this.list[n]=this.list[l],this.list[l]=t;for(var a=0;r>a;++a)this.list[a]>t&&(this.left[this.list[a]]=!this.left[this.list[a]])}return e};var It=t.sha1={};if(e){var Nt=require("crypto");It.create=function(){var e=Nt.createHash("sha1");return{update:function(t){e.update(t,"utf8")},digest:function(){return e.digest("hex")}}}}else It.create=function(){return new It.MessageDigest};if(It.hash=function(e){var t=It.create();for(var n in e)t.update(e[n]);return t.digest()},!e){It.Buffer=function(){this.data="",this.read=0},It.Buffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)},It.Buffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},It.Buffer.prototype.bytes=function(){return this.data.slice(this.read)},It.Buffer.prototype.length=function(){return this.data.length-this.read},It.Buffer.prototype.compact=function(){this.data=this.data.slice(this.read),this.read=0},It.Buffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);16>n&&(e+="0"),e+=n.toString(16)}return e},It.MessageDigest=function(){St.initialized||St.init(),this.blockLength=64,this.digestLength=20,this.messageLength=0,this.input=new It.Buffer,this.words=new Array(80),this.state={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520}},It.MessageDigest.prototype.update=function(e){e=unescape(encodeURIComponent(e)),this.messageLength+=e.length,this.input.data+=e,St.update(this.state,this.words,this.input),(this.input.read>2048||0===this.input.length())&&this.input.compact()},It.MessageDigest.prototype.digest=function(){var e=this.messageLength,t=new It.Buffer;t.data+=this.input.bytes(),t.data+=St.padding.substr(0,64-(e+8)%64),t.putInt32(e>>>29&255),t.putInt32(e<<3&4294967295),St.update(this.state,this.words,t);var n=new It.Buffer;return n.putInt32(this.state.h0),n.putInt32(this.state.h1),n.putInt32(this.state.h2),n.putInt32(this.state.h3),n.putInt32(this.state.h4),n.toHex()};var St={padding:null,initialized:!1};St.init=function(){St.padding=String.fromCharCode(128);for(var e=String.fromCharCode(0),t=64;t>0;)1&t&&(St.padding+=e),t>>>=1,t>0&&(e+=e);St.initialized=!0},St.update=function(e,t,n){for(var r,a,i,o,l,s,u,f,c=n.length();c>=64;){for(a=e.h0,i=e.h1,o=e.h2,l=e.h3,s=e.h4,f=0;16>f;++f)r=n.getInt32(),t[f]=r,u=l^i&(o^l),r=(a<<5|a>>>27)+u+s+1518500249+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;for(;20>f;++f)r=t[f-3]^t[f-8]^t[f-14]^t[f-16],r=r<<1|r>>>31,t[f]=r,u=l^i&(o^l),r=(a<<5|a>>>27)+u+s+1518500249+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;for(;32>f;++f)r=t[f-3]^t[f-8]^t[f-14]^t[f-16],r=r<<1|r>>>31,t[f]=r,u=i^o^l,r=(a<<5|a>>>27)+u+s+1859775393+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;for(;40>f;++f)r=t[f-6]^t[f-16]^t[f-28]^t[f-32],r=r<<2|r>>>30,t[f]=r,u=i^o^l,r=(a<<5|a>>>27)+u+s+1859775393+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;for(;60>f;++f)r=t[f-6]^t[f-16]^t[f-28]^t[f-32],r=r<<2|r>>>30,t[f]=r,u=i&o|l&(i^o),r=(a<<5|a>>>27)+u+s+2400959708+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;for(;80>f;++f)r=t[f-6]^t[f-16]^t[f-28]^t[f-32],r=r<<2|r>>>30,t[f]=r,u=i^o^l,r=(a<<5|a>>>27)+u+s+3395469782+r,s=l,l=o,o=i<<30|i>>>2,i=a,a=r;e.h0+=a,e.h1+=i,e.h2+=o,e.h3+=l,e.h4+=s,c-=64}}}if(t.url={},e){var Et=require("url").parse;t.url.parse=function(e){var t=Et(e);return t.pathname=t.pathname||"",at(t),t.normalizedPath=it(t.pathname,""!==t.authority),t}}else{var kt={};kt.options={key:["href","protocol","host","auth","user","password","hostname","port","relative","path","directory","file","query","hash"],parser:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/},t.url.parse=function(e){for(var t=kt.options,n=t.parser.exec(e),r={},a=14;a--;)r[t.key[a]]=n[a]||"";return r.host&&""===r.path&&(r.path="/"),r.pathname=r.path||"",at(r),r.normalizedPath=it(r.pathname,""!==r.authority),r.query&&(r.path=r.path+"?"+r.query),r.protocol&&(r.protocol+=":"),r.hash&&(r.hash="#"+r.hash),r}}return e&&t.useContextLoader("node"),t},r=function(){return n(function(){return r()})};n(r),e?module.exports=r:"function"==typeof define&&define.amd?define("jsonld",[],function(){return r}):t&&(window.jsonld=window.jsonld||r)}();