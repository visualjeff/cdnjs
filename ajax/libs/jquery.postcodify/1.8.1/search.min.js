/* Postcodify, LGPL v3, see https://github.com/kijin/postcodify */
(function($){if("undefined"==typeof $.fn.postcodify){var e={version:"1.8.1",location:""};$("script").each(function(){$(this).attr("src").match(/^(https?:)?\/\/.+\/search\.(min\.)?js(\?|$)/)&&(e.location=$(this).attr("src").replace(/^(https?:)?\/\/([^:/]+)[:/].+$/,"$2"))}),$.fn.postcodify=function(s){return this.each(function(){var a=$.extend({api:e.freeAPI.defaultUrl,apiBackup:null,callBackupFirst:!1,controls:this,results:this,language:"ko",searchButtonContent:null,mapLinkProvider:!1,mapLinkContent:null,insertDbid:null,insertPostcode5:null,insertPostcode6:null,insertAddress:null,insertJibeonAddress:null,insertEnglishAddress:null,insertEnglishJibeonAddress:null,insertDetails:null,insertExtraInfo:null,timeout:2400,timeoutBackup:7200,beforeSearch:function(){},afterSearch:function(){},beforeSelect:function(){},afterSelect:function(){},onReady:function(){},onSuccess:function(){},onBackup:function(){},onError:function(){},onComplete:function(){},focusKeyword:!0,focusDetails:!0,hideOldAddresses:!0,useFullJibeon:!1},s);a.language=a.language.toLowerCase(),a.api===e.freeAPI.defaultUrl&&null===a.apiBackup&&(a.apiBackup=e.freeAPI.backupUrl),null===a.searchButtonContent&&(a.searchButtonContent=e.translations[a.language].msgSearch);var r=$(a.results),i=$('<div class="postcode_search_controls"></div>'),n=$('<input type="text" class="keyword" value="" />').appendTo(i),t=$('<button type="button" class="search_button"></button>').html(a.searchButtonContent).appendTo(i);i.prependTo(a.controls);var o="";return n.blur(function(){t.trigger("click")}),n.keypress(function(e){13==e.which&&(e.preventDefault(),t.trigger("click"))}),t.click(function(A){A.preventDefault();var s=$.trim(n.val());if(s!==o){if(o=s,r.find("div.postcode_search_result,div.postcode_search_status").remove(),s.length<3)return void $('<div class="postcode_search_status too_short"></div>').html(e.translations[a.language].errorTooShort.replace("\n","<br>")).appendTo(r);if(a.beforeSearch(s)!==!1){var h=$(window).scrollTop();t.attr("disabled","disabled");var d;navigator.userAgent&&navigator.userAgent.match(/MSIE [5-8]\./)?(t.text("."),d=setInterval(function(){switch(t.text()){case".":t.text("..");break;case"..":t.text("...");break;case"...":t.text("....");break;case"....":t.text(".")}},160)):(t.html('<img class="searching" alt="'+e.translations[a.language].msgSearch+'" src="'+e.searchProgress+'" />'),d=!1);var c,p,u,i,l=function(r,n,o){c=(new Date).getTime(),a.currentRequestUrl=r,$.ajax({url:r,data:{v:e.version,q:s,ref:window.location.hostname,cdn:e.location},dataType:"jsonp",jsonpCallback:"postcodify"+c,processData:!0,cache:!1,timeout:n,success:p,error:o,complete:function(){$(window).scrollTop(h),d!==!1&&clearTimeout(d),t.removeAttr("disabled").html(a.searchButtonContent)}})};p=function(n){var k=((new Date).getTime()-c)/1e3;if(a.currentRequestUrl===a.apiBackup&&(a.callBackupFirst=!0),a.afterSearch(s,n.results)!==!1){if(n.error&&n.error.toLowerCase().indexOf("database")>-1)a.currentRequestUrl===a.api&&a.apiBackup&&a.api!==a.apiBackup&&(a.onBackup(),l(a.apiBackup,a.timeoutBackup,i));else if(n.error&&n.error.toLowerCase().indexOf("quota")>-1)$('<div class="postcode_search_status quota"></div>').html(e.translations[a.language].errorQuota.replace("\n","<br>")).appendTo(r);else if(n.error)$('<div class="postcode_search_status error"></div>').html(e.translations[a.language].errorError.replace("\n","<br>")).appendTo(r),o="";else if(0===n.count)$('<div class="postcode_search_status empty"></div>').html(e.translations[a.language].errorEmpty.replace("\n","<br>")).appendTo(r);else if("undefined"==typeof n.results[0].english||"undefined"==typeof n.results[0].other)$('<div class="postcode_search_status error"></div>').html(e.translations[a.language].errorVersion.replace("\n","<br>")).appendTo(r);else{var p;p="undefined"!=typeof n.lang&&"EN"===n.lang?"en":"ko";for(var f=0;f<n.count;f++){var t=n.results[f],d=$('<div class="postcode_search_result"></div>');d.data("dbid",t.dbid),d.data("code6",t.code6),d.data("code5",t.code5),d.data("address",t.address.base+" "+t.address["new"]),d.data("jibeon_address",t.address.base+" "+t.address.old),d.data("english_address",t.english["new"]+", "+t.english.base),d.data("english_jibeon_address",t.english.old+", "+t.english.base),d.data("extra_info_long",t.other["long"]),d.data("extra_info_short",t.other["short"]);var h,u;"en"===p?"undefined"!=typeof n.sort&&"JIBEON"===n.sort?(h=t.english.old+", "+t.english.base,u=t.english["new"]):(h=t.english["new"]+", "+t.english.base,u=t.english.old):"undefined"!=typeof n.sort&&"JIBEON"===n.sort?(h=t.address.base+" "+t.address.old,u=t.address["new"]):(h=t.address.base+" "+t.address["new"],u=t.other["long"]);var m=$('<a class="selector" href="#"></a>');if(m.append($('<span class="address_info"></span>').text(h)),null!==u&&""!==u&&m.append($('<span class="extra_info"></span>').append("("+u+")")),$('<div class="code6"></div>').text(t.code6).appendTo(d),$('<div class="code5"></div>').text(t.code5).appendTo(d),$('<div class="address"></div>').append(m).appendTo(d),"undefined"!=typeof n.lang&&"EN"===n.lang&&(t.other.others=t.other.others.replace(/\uc0b0([0-9]+)/g,"San $1"),t.other.others=$.trim(t.other.others.replace(/[^0-9a-zA-Z\x20.,-]/g,"").replace(/\s+/g," "))),""!==t.other.others){var b=$('<a href="#" class="show_old_addresses">▼</a>').attr("title",e.translations[p].msgShowOthers);b.appendTo(d.find("div.address"));var v=$('<div class="old_addresses"></div>').text(t.other.others);a.hideOldAddresses&&v.css("display","none"),v.appendTo(d)}if(a.mapLinkProvider){var A;A="undefined"!=typeof e.mapProviders[a.mapLinkProvider]?e.mapProviders[a.mapLinkProvider]:a.mapLinkProvider,A=A.replace("$JUSO",encodeURIComponent(t.address.base+" "+t.address["new"]).replace(/%20/g,"+")),A=A.replace("$JIBEON",encodeURIComponent(t.address.base+" "+t.address.old).replace(/%20/g,"+"));var w=null!==a.mapLinkContent?a.mapLinkContent:e.translations[p].msgMap,_=$('<a target="_blank"></a>').attr("href",A).html(w);$('<div class="map_link"></div>').append(_).appendTo(d)}d.appendTo(r)}var g=$('<div class="postcode_search_status summary"></div>');g.append('<div class="result_count">'+e.translations[p].msgResultCount+": <span>"+n.count+"</span></div>"),g.append('<div class="search_time">'+e.translations[p].msgSearchTime+": <span>"+Math.round(1e3*n.time)+"ms</span></div>"),g.append('<div class="network_time">'+e.translations[p].msgNetworkTime+": <span>"+Math.round(1e3*(k-parseFloat(n.time)))+"ms</span></div>"),g.appendTo(r),n.count>=100&&$('<div class="postcode_search_status too_many"></div>').html(e.translations[p].errorTooMany.replace("\n","<br>")).prependTo(r)}a.onSuccess(),a.onComplete()}},u=function(e,s,r){a.apiBackup?(a.onBackup(),l(a.apiBackup,a.timeoutBackup,i)):i(e,s,r)},i=function(){r.find("div.postcode_search_status.error").show(),o="",a.onError(),a.onComplete()},a.apiBackup&&a.callBackupFirst?l(a.apiBackup,a.timeoutBackup,i):l(a.api,a.timeout,u)}}}),r.on("click","div.code6,div.code5,div.old_addresses",function(e){e.preventDefault(),e.stopPropagation(),$(this).parent().find("a.selector").click()}),r.on("click","a.selector",function(r){r.preventDefault();var e=$(this).parents("div.postcode_search_result");if(a.beforeSelect(e)!==!1){if(a.insertDbid&&$(a.insertDbid).val(e.data("dbid")),a.insertPostcode6&&$(a.insertPostcode6).val(e.data("code6")),a.insertPostcode5&&$(a.insertPostcode5).val(e.data("code5")),a.insertAddress&&$(a.insertAddress).val(e.data("address")),a.insertJibeonAddress&&$(a.insertJibeonAddress).val(e.data("jibeon_address")),a.insertEnglishAddress&&$(a.insertEnglishAddress).val(e.data("english_address")),a.insertEnglishJibeonAddress&&$(a.insertEnglishJibeonAddress).val(e.data("english_jibeon_address")),a.insertExtraInfo){var s=e.data(a.useFullJibeon?"extra_info_long":"extra_info_short");s.length&&(s="("+s+")"),$(a.insertExtraInfo).val(a.insertExtraInfo===a.insertAddress?$(a.insertExtraInfo).val()+"\n"+s:s)}a.afterSelect(e)!==!1&&a.insertDetails&&a.focusDetails&&$(a.insertDetails).focus()}}),r.on("click","a.show_old_addresses",function(s){s.preventDefault();var e=$(this).parent().siblings(".old_addresses");e.is(":visible")?($(this).html("&#9660;"),e.hide()):($(this).html("&#9650;"),e.show())}),a.focusKeyword&&n.focus(),a.onReady(),this})},e.freeAPI={defaultUrl:"//api.poesis.kr/post/search.php",backupUrl:"//backup.api.poesis.kr/post/search.php"},e.mapProviders={daum:"http://map.daum.net/?map_type=TYPE_MAP&urlLevel=3&q=$JUSO",naver:"http://map.naver.com/?mapMode=0&dlevel=12&query=$JUSO",google:"http://www.google.com/maps/place/대한민국+$JUSO"},e.translations={ko:{errorError:"검색 서버와 통신 중 오류가 발생하였습니다.\n잠시 후 다시 시도해 주시기 바랍니다.",errorEmpty:"검색 결과가 없습니다. 주소가 정확한지 다시 확인해 주십시오.\n띄어쓰기에 유의하시기 바랍니다.",errorQuota:"일일 허용 쿼리수를 초과하였습니다.\n관리자에게 문의해 주시기 바랍니다.",errorVersion:"검색 서버의 버전이 낮아 이 검색창과 호환되지 않습니다.",errorTooShort:"검색어는 3글자 이상 입력해 주십시오.",errorTooMany:"검색 결과가 너무 많아 100건까지만 표시합니다.\n행정구역명, 번지수 등을 사용하여 좀더 자세히 검색해 주시기 바랍니다.",msgResultCount:"검색 결과",msgSearchTime:"소요 시간",msgNetworkTime:"통신 지연",msgSeeOthers:"관련지번 보기",msgSearch:"검색",msgMap:"지도"},en:{errorError:"An error occurred while communicating to the search server.\nPlease try again later.",errorEmpty:"No addresses matched your search.\nPlease check if your search terms are accurately spelled.",errorQuota:"This website and/or your IP address has exceeded its daily search quota.\nPlease contact the administrator.",errorVersion:"The version of the search server is not compatible with this search function.",errorTooShort:"Please enter at least 3 characters.",errorTooMany:"Your search returned too many results. Only the first 100 items are shown below.\nPlease narrow down your search by adding the street number(s).",msgResultCount:"Results",msgSearchTime:"Time taken",msgNetworkTime:"Network delay",msgSeeOthers:"See related addresses",msgSearch:"Search",msgMap:"Map"}},e.searchProgress="data:image/gif;base64,R0lGODlhEAALAPQAAP///yIiIt7e3tbW1uzs7CcnJyIiIklJSZKSknV1dcPDwz8/P2JiYpmZmXh4eMbGxkJCQiUlJWVlZenp6d3d3fX19VJSUuDg4PPz87+/v6ysrNDQ0PDw8AAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA"}})(jQuery);