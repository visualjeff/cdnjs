// Foggy, v1.02
//
// Description: jQuery plugin for blurring page elements
// Homepage:    http://nbartlomiej.github.com/foggy
// Author:      nbartlomiej@gmail.com

(function(a){a.fn.foggy=function(b){var c=a.extend({opacity:.8,blurRadius:2,quality:16,cssFilterSupport:true},b);var d=function(a,b,c,d){this.content=a;this.position=b;this.offset=c;this.opacity=d};d.prototype.render=function(b){a("<div/>",{html:this.content}).css({position:this.position,opacity:this.opacity,top:this.offset[0],left:this.offset[1]}).appendTo(b)};var e=function(a){this.radius=a};e.prototype.includes=function(a,b){if(Math.pow(a,2)+Math.pow(b,2)<=Math.pow(this.radius,2)){return true}else{return false}};e.prototype.points=function(){var a=[];for(var b=-this.radius;b<=this.radius;b++){for(var c=-this.radius;c<=this.radius;c++){if(this.includes(b,c)){a.push([b,c])}}}return a};var f=function(a,b){this.element=a;this.settings=b};f.prototype.calculateOffsets=function(b,c){var d=a.grep((new e(b+1)).points(),function(a){return a[0]!=0||a[1]!=0});var f;if(d.length<=c){f=d}else{var g=d.length-c;var h=[];for(var i=0;i<g;i++){h.push(Math.round(i*(d.length/g)))}f=a.grep(d,function(b,c){if(a.inArray(c,h)>=0){return false}else{return true}})}return f};f.prototype.render=function(){var b=a(this.element).html();a(this.element).empty();var c=a("<div/>").css({position:"relative"});var e=this.calculateOffsets(this.settings.blurRadius,this.settings.quality);var f=this.settings.opacity*1.2/(e.length+1);(new d(b,"relative",[0,0],f)).render(c);a(e).each(function(a,e){(new d(b,"absolute",e,f)).render(c)});c.appendTo(this.element)};var g=function(a,b){this.element=a;this.settings=b};g.prototype.render=function(){var b=(""+c.opacity).slice(2,4);a(this.element).css({"-webkit-filter":"blur("+this.settings.blurRadius+"px)",opacity:c.opacity})};return this.each(function(a,b){if(c.cssFilterSupport&&"-webkit-filter"in document.body.style){(new g(b,c)).render()}else{(new f(b,c)).render()}})}})(jQuery)