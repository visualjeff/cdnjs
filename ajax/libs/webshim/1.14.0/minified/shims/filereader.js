webshim.register("filereader",function(a,b,c,d,e,f){"use strict";var g,h,i=a.noop,j='input[type="file"].ws-filereader',k=function(){b.loader.loadList(["moxie"])},l=function(){var c,d,e,f=this;b.implement(f,"filepicker")&&(f=this,c=a(this),e=c.parent(),c.on("mousedown.filereaderwaiting click.filereaderwaiting",!1),e.addClass("ws-loading"),d=new g.FileInput({browse_button:this,accept:a.prop(this,"accept"),multiple:a.prop(this,"multiple")}),d.onready=function(){c.off(".fileraderwaiting"),e.removeClass("ws-waiting")},d.onchange=function(a){b.data(f,"fileList",a.target.files),c.trigger("change")},d.onmouseenter=function(){c.trigger("mouseover"),e.addClass("ws-mouseenter")},d.onmouseleave=function(){c.trigger("mouseout"),e.removeClass("ws-mouseenter")},d.onmousedown=function(){c.trigger("mousedown"),e.addClass("ws-active")},d.onmouseup=function(){c.trigger("mouseup"),e.removeClass("ws-active")},b.data(f,"filePicker",d),b.ready("WINDOWLOAD",function(){var a;c.onWSOff("updateshadowdom",function(){var b=f.offsetWidth;b&&a!=b&&(a=b,d.refresh())})}),b.addShadowDom(),d.init(),f.disabled&&d.disable(!0))},m=function(a){return a.name},n=function(){var c=this;k(),a(c).on("mousedown.filereaderwaiting click.filereaderwaiting",!1).parent().addClass("ws-loading"),b.ready("moxie",function(){n.call(c)})},o=/^(?:script|jsonp)$/i,p=function(){k(),b.error('filereader/formdata not ready yet. please wait for moxie to load `webshim.ready("moxie", callbackFn);`` or wait for the first change event on input[type="file"].ws-filereader.')},q=b.defineNodeNameProperty("input","value",{prop:{get:function(){var a=b.data(this,"fileList");return a&&a.map?a.map(m).join(", "):q.prop._supget.call(this)}}}),r=function(b){return"moxie"==b.wsType||b.data&&b.data instanceof g.FormData||b.crossDomain&&a.support.cors!==!1&&!o.test(b.dataType||"")},s=function(b){if(r(b)){var c;return{send:function(d,e){var g=function(a,d){if(b[d]){var e=!1;c.addEventListener("load",function(){e?e.lengthComputable&&e.total>e.loaded&&b[d]({type:"progress",lengthComputable:!0,total:e.total,loaded:e.total}):b[d]({type:"progress",lengthComputable:!0,total:1,loaded:1})}),a.addEventListener("progress",function(a){e=a,b[d](a)})}};c=new h.xhr.XMLHttpRequest,c.open(b.type,b.url,b.async,b.username,b.password),g(c.upload,f.uploadprogress),g(c.upload,f.progress),c.addEventListener("load",function(){var a={text:c.responseText,xml:c.responseXML};e(c.status,c.statusText,a,c.getAllResponseHeaders())}),b.xhrFields&&b.xhrFields.withCredentials&&(c.withCredentials=!0),b.timeout&&(c.timeout=b.timeout),a.each(d,function(a,b){c.setRequestHeader(a,b)}),c.send(b.data)},abort:function(){c&&c.abort()}}}},t={xdomain:function(){var b=/^https?:\/\//i,c=/^get|post$/i,d=new RegExp("^"+location.protocol,"i");return function(e,f){if(!(!e.crossDomain||e.username||e.xhrFields&&e.xhrFields.withCredentials||!e.async||!c.test(e.type)||!b.test(e.url)||!d.test(e.url)||e.data&&e.data instanceof g.FormData||o.test(e.dataType||""))){var h=null;return{send:function(b,c){var d="",g=(f.dataType||"").toLowerCase();h=new XDomainRequest,/^\d+$/.test(f.timeout)&&(h.timeout=f.timeout),h.ontimeout=function(){c(500,"timeout")},h.onload=function(){var b="Content-Length: "+h.responseText.length+"\r\nContent-Type: "+h.contentType,d={code:h.status||200,message:h.statusText||"OK"},e={text:h.responseText,xml:h.responseXML};try{if("html"===g||/text\/html/i.test(h.contentType))e.html=h.responseText;else if("json"===g||"text"!==g&&/\/json/i.test(h.contentType))try{e.json=a.parseJSON(h.responseText)}catch(f){}else if("xml"===g&&!h.responseXML){var i;try{i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(h.responseText)}catch(f){}e.xml=i}}catch(j){}c(d.code,d.message,e,b)},h.onprogress=function(){},h.onerror=function(){c(500,"error",{text:h.responseText})},f.data&&(d="string"===a.type(f.data)?f.data:a.param(f.data)),h.open(e.type,e.url),h.send(d)},abort:function(){h&&h.abort()}}}}}(),moxie:function(a,c,d){if(r(a)){k(a);var e,f={send:function(g,h){e=!0,b.ready("moxie",function(){e&&(e=s(a,c,d),f.send=e.send,f.abort=e.abort,e.send(g,h))})},abort:function(){e=!1}};return f}}};f.progress||(f.progress="onprogress"),f.uploadprogress||(f.uploadprogress="onuploadprogress"),a.support.cors===!1&&c.XDomainRequest||delete t.xdomain,a.ajaxTransport("+*",function(a,b,c){var d,e;if((a.wsType||t[t])&&(d=t[t](a,b,c)),!d)for(e in t)if(d=t[e](a,b,c))break;return d}),b.defineNodeNameProperty("input","files",{prop:{writeable:!1,get:function(){return"file"!=this.type?null:(a(this).is(".ws-filereader")||b.error("please add the 'ws-filereader' class to your input[type='file'] to implement files-property"),b.data(this,"fileList")||c.FileList&&b.data(this,"fileList",new FileList)||[])}}}),b.reflectProperties(["input"],["accept"]),null==a("<input />").prop("multiple")&&b.defineNodeNamesBooleanProperty(["input"],["multiple"]),b.onNodeNamesPropertyModify("input","disabled",function(a,c){var d=b.data(this,"filePicker");d&&d.disable(c)}),c.FileReader=p,c.FormData=p,b.ready("moxie",function(){h=c.moxie,g=c.mOxie,g.Env.swf_url=b.cfg.basePath+"moxie/flash/Moxie.cdn.swf",g.Env.xap_url=b.cfg.basePath+"moxie/flash/Moxie.cdn.xap",c.FileReader=g.FileReader,c.FormData=function(b){var c,d,e,f,h,i,j,k=new g.FormData;if(b&&a.nodeName(b,"form")){for(c=a(b).serializeArray(),d=0;d<c.length;d++)k.append(c[d].name,c[d].value);for(c=b.querySelectorAll('input[type="file"][name]'),d=0,e=c.length;d<c.length;d++)if(j=c[d].name,j&&!a(c[d]).is(":disabled"))for(f=a.prop(c[d],"files")||[],h=0,i=f.length;i>h;h++)k.append(j,f[h])}return k},i=c.FormData,n=l,t.moxie=s}),b.addReady(function(b,c){a(b.querySelectorAll(j)).add(c.filter(j)).each(n)}),b.ready("WINDOWLOAD",k)});