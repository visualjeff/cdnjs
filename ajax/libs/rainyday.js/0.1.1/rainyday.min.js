function RainyDay(t,i,e,s,a,r){this.canvasid=t,this.canvas=document.getElementById(t),this.sourceid=i,this.img=document.getElementById(i),this.prepareBackground(r?r:20,e,s),this.w=this.canvas.width,this.h=this.canvas.height,this.prepareGlass(a?a:1),this.reflection||(this.reflection=this.REFLECTION_MINIATURE),this.trail||(this.trail=this.TRAIL_DROPS),this.gravity||(this.gravity=this.GRAVITY_NONE),this.VARIABLE_GRAVITY_THRESHOLD=3,this.VARIABLE_GRAVITY_ANGLE=Math.PI/2,this.VARIABLE_FPS=25,this.VARIABLE_FILL_STYLE="#8ED6FF"}function Drop(t,i,e,s,a){this.x=Math.floor(i),this.y=Math.floor(e),this.r1=Math.random()*a+s,this.rainyday=t;var r=4;this.r2=.8*this.r1,this.linepoints=t.getLinepoints(r),this.context=t.context,this.reflection=t.reflected}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}RainyDay.prototype.prepareReflections=function(){this.reflected=document.createElement("canvas"),this.reflected.width=this.canvas.width,this.reflected.height=this.canvas.height;var t=this.reflected.getContext("2d");t.translate(this.reflected.width/2,this.reflected.height/2),t.rotate(Math.PI),t.drawImage(this.img,-this.reflected.width/2,-this.reflected.height/2,this.reflected.width,this.reflected.height)},RainyDay.prototype.prepareGlass=function(t){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.glass.style.position="absolute",this.glass.style.top=this.canvas.offsetTop,this.glass.style.left=this.canvas.offsetLeft,this.glass.style.zIndex=this.canvas.style.zIndex+100,this.canvas.parentNode.appendChild(this.glass),this.context=this.glass.getContext("2d"),this.glass.style.opacity=t},RainyDay.prototype.preset=function(t,i,e){return{min:t,base:i,quan:e}},RainyDay.prototype.rain=function(t,i){if(this.reflection!=this.REFLECTION_NONE&&this.prepareReflections(),i>0)this.presets=t,this.PRIVATE_GRAVITY_FORCE_FACTOR_Y=.005*this.VARIABLE_FPS/25,this.PRIVATE_GRAVITY_FORCE_FACTOR_X=.005*(Math.PI/2-this.VARIABLE_GRAVITY_ANGLE)*this.VARIABLE_FPS/50,setInterval(function(i){return function(){for(var e,s=Math.random(),a=0;a<t.length;a++)if(s<t[a].quan){e=t[a];break}e&&i.putDrop(new Drop(i,Math.random()*i.w,Math.random()*i.h,e.min,e.base))}}(this),i);else for(var e=0;e<t.length;e++)for(var s=t[e],a=0;a<s.quan;++a)this.putDrop(new Drop(this,Math.random()*this.w,Math.random()*this.h,s.min,s.base))},RainyDay.prototype.putDrop=function(t){t.draw(),this.gravity&&t.r1>this.VARIABLE_GRAVITY_THRESHOLD&&t.animate()},RainyDay.prototype.getLinepoints=function(t){var i={};i.first={x:0,y:1};var e,s,a,r,n,h={x:1,y:1},o=1,y=1;i.first.next=h;for(var l=0;t>l;l++)for(e=i.first;null!=e.next;){s=e.next,a=s.x-e.x,r=.5*(e.x+s.x),n=.5*(e.y+s.y),n+=a*(2*Math.random()-1);var c={x:r,y:n};o>n?o=n:n>y&&(y=n),c.next=s,e.next=c,e=s}if(y!=o){var R=1/(y-o);for(e=i.first;null!=e;)e.y=R*(e.y-o),e=e.next}else for(e=i.first;null!=e;)e.y=1,e=e.next;return i},Drop.prototype.draw=function(){var t,i,e,s,a,r=0;for(this.context.save(),this.context.beginPath(),t=this.linepoints.first,e=r,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),a=this.y+i*Math.sin(e),this.context.lineTo(s,a);null!=t.next;)t=t.next,e=2*Math.PI*t.x+r,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),a=this.y+i*Math.sin(e),this.context.lineTo(s,a);this.context.clip(),this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},Drop.prototype.clear=function(){return this.y-this.r1>this.rainyday.h?(clearInterval(this.intid),!0):this.x-this.r1>this.rainyday.w||this.x+this.r1<0?(clearInterval(this.intid),!0):(this.context.clearRect(this.x-this.r1-1,this.y-this.r1-1,2*this.r1+2,2*this.r1+2),!1)},Drop.prototype.animate=function(){this.intid=setInterval(function(t){return function(){if(t.rainyday.gravity){var i=t.rainyday.gravity(t);!i&&t.rainyday.trail&&t.rainyday.trail(t)}}}(this),Math.floor(1e3/this.rainyday.VARIABLE_FPS))},RainyDay.prototype.TRAIL_NONE=function(){},RainyDay.prototype.TRAIL_DROPS=function(t){(!t.trail_y||t.y-t.trail_y>=10*Math.random()*t.r1)&&(t.trail_y=t.y,this.putDrop(new Drop(this,t.x,t.y-t.r1-5,0,Math.ceil(t.r1/5))))},RainyDay.prototype.GRAVITY_NONE=function(){return!0},RainyDay.prototype.GRAVITY_LINEAR=function(t){return t.clear()?!0:(t.yspeed?(t.yspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.draw(),!1)},RainyDay.prototype.GRAVITY_NON_LINEAR=function(t){return t.clear()?!0:((!t.seed||t.seed<0)&&(t.seed=Math.floor(Math.random()*this.VARIABLE_FPS),t.skipping=0==t.skipping?!0:!1,t.slowing=!0),t.seed--,t.yspeed?t.slowing?(t.yspeed/=1.1,t.xspeed/=1.1,t.yspeed<this.PRIVATE_GRAVITY_FORCE_FACTOR_Y&&(t.slowing=!1)):t.skipping?(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X):(t.yspeed+=10*this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=10*this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.x+=t.xspeed,t.draw(),!1)},RainyDay.prototype.REFLECTION_NONE=function(){this.context.fillStyle=this.VARIABLE_FILL_STYLE,this.context.fill()},RainyDay.prototype.REFLECTION_MINIATURE=function(t){this.context.drawImage(this.reflected,t.x-t.r1,t.y-t.r1,2*t.r1,2*t.r1)};var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];RainyDay.prototype.prepareBackground=function(t,i,e){i&&e?(this.canvas.style.width=i+"px",this.canvas.style.height=e+"px",this.canvas.width=i,this.canvas.height=e):(i=this.canvas.width,e=this.canvas.height);var s=this.canvas.getContext("2d");s.clearRect(0,0,i,e),s.drawImage(this.img,0,0,i,e),isNaN(t)||1>t||this.stackBlurCanvasRGB(0,0,i,e,t)},RainyDay.prototype.stackBlurCanvasRGB=function(t,i,e,s,a){a|=0;var r,n,h,o,y,l,c,R,p,d,f,_,A,I,g,x,E,u,T,v,V=this.canvas.getContext("2d"),O=V.getImageData(t,i,e,s),F=O.data,C=a+a+1,m=e-1,D=s-1,L=a+1,w=L*(L+1)/2,M=new BlurStack,Y=M;for(h=1;C>h;h++)if(Y=Y.next=new BlurStack,h==L)var G=Y;Y.next=M;var N=null,P=null;c=l=0;var B=mul_table[a],b=shg_table[a];for(n=0;s>n;n++){for(I=g=x=R=p=d=0,f=L*(E=F[l]),_=L*(u=F[l+1]),A=L*(T=F[l+2]),R+=w*E,p+=w*u,d+=w*T,Y=M,h=0;L>h;h++)Y.r=E,Y.g=u,Y.b=T,Y=Y.next;for(h=1;L>h;h++)o=l+((h>m?m:h)<<2),R+=(Y.r=E=F[o])*(v=L-h),p+=(Y.g=u=F[o+1])*v,d+=(Y.b=T=F[o+2])*v,I+=E,g+=u,x+=T,Y=Y.next;for(N=M,P=G,r=0;e>r;r++)F[l]=R*B>>b,F[l+1]=p*B>>b,F[l+2]=d*B>>b,R-=f,p-=_,d-=A,f-=N.r,_-=N.g,A-=N.b,o=c+((o=r+a+1)<m?o:m)<<2,I+=N.r=F[o],g+=N.g=F[o+1],x+=N.b=F[o+2],R+=I,p+=g,d+=x,N=N.next,f+=E=P.r,_+=u=P.g,A+=T=P.b,I-=E,g-=u,x-=T,P=P.next,l+=4;c+=e}for(r=0;e>r;r++){for(g=x=I=p=d=R=0,l=r<<2,f=L*(E=F[l]),_=L*(u=F[l+1]),A=L*(T=F[l+2]),R+=w*E,p+=w*u,d+=w*T,Y=M,h=0;L>h;h++)Y.r=E,Y.g=u,Y.b=T,Y=Y.next;for(y=e,h=1;a>=h;h++)l=y+r<<2,R+=(Y.r=E=F[l])*(v=L-h),p+=(Y.g=u=F[l+1])*v,d+=(Y.b=T=F[l+2])*v,I+=E,g+=u,x+=T,Y=Y.next,D>h&&(y+=e);for(l=r,N=M,P=G,n=0;s>n;n++)o=l<<2,F[o]=R*B>>b,F[o+1]=p*B>>b,F[o+2]=d*B>>b,R-=f,p-=_,d-=A,f-=N.r,_-=N.g,A-=N.b,o=r+((o=n+L)<D?o:D)*e<<2,R+=I+=N.r=F[o],p+=g+=N.g=F[o+1],d+=x+=N.b=F[o+2],N=N.next,f+=E=P.r,_+=u=P.g,A+=T=P.b,I-=E,g-=u,x-=T,P=P.next,l+=e}V.putImageData(O,t,i)};