function RainyDay(t,i,a,n,s,e){this.canvasid=t,this.canvas=document.getElementById(t),this.sourceid=i,this.img=document.getElementById(i),this.prepareBackground(e?e:20,a,n),this.w=this.canvas.width,this.h=this.canvas.height,this.prepareGlass(s?s:.9),this.prepareMiniatures()}function Drop(t,i,a,n,s){this.x=Math.floor(i),this.y=Math.floor(a),this.r1=Math.random()*s+n,this.rainyday=t;var e=5;this.r2=.88*this.r1,this.linepoints=t.getLinepoints(e),this.context=t.context,this.mini=t.mini}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}RainyDay.prototype.prepareMiniatures=function(){this.mini=document.createElement("canvas"),this.mini.width=this.canvas.width/2,this.mini.height=this.canvas.height/2;var t=this.mini.getContext("2d");t.translate(this.mini.width/2,this.mini.height/2),t.rotate(Math.PI),t.drawImage(this.img,-this.mini.width/2,-this.mini.height/2,this.mini.width,this.mini.height)},RainyDay.prototype.prepareGlass=function(t){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.glass.style.position="absolute",this.glass.style.top=this.canvas.offsetTop,this.glass.style.left=this.canvas.offsetLeft,this.glass.style.zIndex=this.canvas.style.zIndex+100,this.canvas.parentNode.appendChild(this.glass),this.context=this.glass.getContext("2d"),this.glass.style.opacity=t},RainyDay.prototype.preset=function(t,i,a){return{min:t,base:i,quan:a}},RainyDay.prototype.rain=function(t,i){if(i>0)this.presets=t,setInterval(function(i){return function(){for(var a,n=Math.random(),s=0;s<t.length;s++)if(n<t[s].quan){a=t[s];break}a&&i.putDrop(new Drop(i,Math.random()*i.w,Math.random()*i.h,a.min,a.base))}}(this),i);else for(var a=0;a<t.length;a++)for(var n=t[a],s=0;s<n.quan;++s)this.putDrop(new Drop(this,Math.random()*this.w,Math.random()*this.h,n.min,n.base))},RainyDay.prototype.putDrop=function(t){t.draw(),this.gravity&&t.animate()},RainyDay.prototype.getLinepoints=function(t){var i={};i.first={x:0,y:1};var a,n,s,e,r,h={x:1,y:1},o=1,y=1;i.first.next=h;for(var l=0;t>l;l++)for(a=i.first;null!=a.next;){n=a.next,s=n.x-a.x,e=.5*(a.x+n.x),r=.5*(a.y+n.y),r+=s*(2*Math.random()-1);var c={x:e,y:r};o>r?o=r:r>y&&(y=r),c.next=n,a.next=c,a=n}if(y!=o){var p=1/(y-o);for(a=i.first;null!=a;)a.y=p*(a.y-o),a=a.next}else for(a=i.first;null!=a;)a.y=1,a=a.next;return i},Drop.prototype.draw=function(){var t,i,a,n,s,e=0;for(this.context.save(),this.context.beginPath(),t=this.linepoints.first,a=e,i=this.r2+t.y*(this.r1-this.r2),n=this.x+i*Math.cos(a),s=this.y+i*Math.sin(a),this.context.lineTo(n,s);null!=t.next;)t=t.next,a=2*Math.PI*t.x+e,i=this.r2+t.y*(this.r1-this.r2),n=this.x+i*Math.cos(a),s=this.y+i*Math.sin(a),this.context.lineTo(n,s);this.context.clip(),this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},Drop.prototype.animate=function(){this.intid=setInterval(function(t){return function(){if(t.rainyday.gravity){var i=t.rainyday.gravity(t);i||t.rainyday.trail&&t.rainyday.trail(t)}}}(this),10)},RainyDay.prototype.TRAIL_DROPS=function(t){(!t.trail_y||t.y-t.trail_y>=10*Math.random()*t.r1)&&(t.trail_y=t.y,this.putDrop(new Drop(this,t.x,t.y-t.r1-5,0,Math.ceil(t.r1/5))))},RainyDay.prototype.GRAVITY_SIMPLE=function(t){return t.r1<3?(clearInterval(t.intid),!0):(this.context.clearRect(t.x-t.r1-1,t.y-t.r1-1,2*t.r1+2,2*t.r1+2),t.y-t.r1>this.glass.height?(clearInterval(t.intid),!0):(t.speed?t.speed+=.005*Math.floor(t.r1):t.speed=.1,t.y+=t.speed,t.draw(),!1))},RainyDay.prototype.REFLECTION_NONE=function(){this.context.fillStyle="#8ED6FF",this.context.fill()},RainyDay.prototype.REFLECTION_HQ=function(t){var i=t.x*this.mini.width/this.glass.width,a=t.y*this.mini.height/this.glass.height,n=10*t.r1,s=10*t.r1;this.context.drawImage(this.mini,0>i-n?0:i-n,0>a-s?0:a-s,2*n,2*s,t.x-t.r1,t.y-t.r1,2*t.r1,2*t.r1)};var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];RainyDay.prototype.prepareBackground=function(t,i,a){i&&a?(this.canvas.style.width=i+"px",this.canvas.style.height=a+"px",this.canvas.width=i,this.canvas.height=a):(i=this.canvas.width,a=this.canvas.height);var n=this.canvas.getContext("2d");n.clearRect(0,0,i,a),n.drawImage(this.img,0,0,i,a),isNaN(t)||1>t||this.stackBlurCanvasRGB(0,0,i,a,t)},RainyDay.prototype.stackBlurCanvasRGB=function(t,i,a,n,s){s|=0;var e,r,h,o,y,l,c,p,g,f,d,u,x,v,m,w,D,R,b,M,I=this.canvas.getContext("2d"),B=I.getImageData(t,i,a,n),E=B.data,_=s+s+1,C=a-1,k=n-1,L=s+1,N=L*(L+1)/2,T=new BlurStack,S=T;for(h=1;_>h;h++)if(S=S.next=new BlurStack,h==L)var G=S;S.next=T;var P=null,F=null;c=l=0;var O=mul_table[s],q=shg_table[s];for(r=0;n>r;r++){for(v=m=w=p=g=f=0,d=L*(D=E[l]),u=L*(R=E[l+1]),x=L*(b=E[l+2]),p+=N*D,g+=N*R,f+=N*b,S=T,h=0;L>h;h++)S.r=D,S.g=R,S.b=b,S=S.next;for(h=1;L>h;h++)o=l+((h>C?C:h)<<2),p+=(S.r=D=E[o])*(M=L-h),g+=(S.g=R=E[o+1])*M,f+=(S.b=b=E[o+2])*M,v+=D,m+=R,w+=b,S=S.next;for(P=T,F=G,e=0;a>e;e++)E[l]=p*O>>q,E[l+1]=g*O>>q,E[l+2]=f*O>>q,p-=d,g-=u,f-=x,d-=P.r,u-=P.g,x-=P.b,o=c+((o=e+s+1)<C?o:C)<<2,v+=P.r=E[o],m+=P.g=E[o+1],w+=P.b=E[o+2],p+=v,g+=m,f+=w,P=P.next,d+=D=F.r,u+=R=F.g,x+=b=F.b,v-=D,m-=R,w-=b,F=F.next,l+=4;c+=a}for(e=0;a>e;e++){for(m=w=v=g=f=p=0,l=e<<2,d=L*(D=E[l]),u=L*(R=E[l+1]),x=L*(b=E[l+2]),p+=N*D,g+=N*R,f+=N*b,S=T,h=0;L>h;h++)S.r=D,S.g=R,S.b=b,S=S.next;for(y=a,h=1;s>=h;h++)l=y+e<<2,p+=(S.r=D=E[l])*(M=L-h),g+=(S.g=R=E[l+1])*M,f+=(S.b=b=E[l+2])*M,v+=D,m+=R,w+=b,S=S.next,k>h&&(y+=a);for(l=e,P=T,F=G,r=0;n>r;r++)o=l<<2,E[o]=p*O>>q,E[o+1]=g*O>>q,E[o+2]=f*O>>q,p-=d,g-=u,f-=x,d-=P.r,u-=P.g,x-=P.b,o=e+((o=r+L)<k?o:k)*a<<2,p+=v+=P.r=E[o],g+=m+=P.g=E[o+1],f+=w+=P.b=E[o+2],P=P.next,d+=D=F.r,u+=R=F.g,x+=b=F.b,v-=D,m-=R,w-=b,F=F.next,l+=a}I.putImageData(B,t,i)};