!function(t){var e,i=this,n=i.document,a=t(n),o=t(i),r=!0,s=navigator.userAgent.toLowerCase(),c=i.location.hash.replace(/#\//,""),h=function(){var t=3,i=n.createElement("div"),a=i.getElementsByTagName("i");do i.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->";while(a[0]);return t>4?t:e}(),u=function(){return{html:n.documentElement,body:n.body,head:n.getElementsByTagName("head")[0],title:n.title}},l="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",d=function(){var e=[];return t.each(l.split(" "),function(t,i){e.push(i),/_/.test(i)&&e.push(i.replace(/_/g,""))}),e}(),p=function(e){var i;return"object"!=typeof e?e:(t.each(e,function(n,a){/^[a-z]+_/.test(n)&&(i="",t.each(n.split("_"),function(t,e){i+=t>0?e.substr(0,1).toUpperCase()+e.substr(1):e}),e[i]=a,delete e[n])}),e)},g=function(e){return t.inArray(e,d)>-1?w[e.toUpperCase()]:e},f={trunk:{},add:function(t,e,n,a){if(a=a||!1,this.clear(t),a){var o=e;e=function(){o(),f.add(t,e,n)}}this.trunk[t]=i.setTimeout(e,n)},clear:function(t){var e,n=function(t){i.clearTimeout(this.trunk[t]),delete this.trunk[t]};if(t&&t in this.trunk)n.call(f,t);else if("undefined"==typeof t)for(e in this.trunk)this.trunk.hasOwnProperty(e)&&n.call(f,e)}},m=[],y=[],v=!1,_=!1,b=function(){return{array:function(t){return Array.prototype.slice.call(t)},create:function(t,e){e=e||"div";var i=n.createElement(e);return i.className=t,i},animate:function(){var e,n,a,o,r,s,c,h=function(t){var e,i="transition WebkitTransition MozTransition OTransition".split(" ");for(e=0;i[e];e++)if("undefined"!=typeof t[i[e]])return i[e];return!1}((document.body||document.documentElement).style),u={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[h],l={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},d=function(e,i,n){var a={};n=n||"transition",t.each("webkit moz ms o".split(" "),function(){a["-"+this+"-"+n]=i}),e.css(a)},p=function(t){d(t,"none","transition"),w.WEBKIT&&(d(t,"translate3d(0,0,0)","transform"),t.data("revert")&&(t.css(t.data("revert")),t.data("revert",null)))};return function(g,f,m){return m=t.extend({duration:400,complete:function(){},stop:!1},m),g=t(g),m.duration?h?(m.stop&&(g.unbind(u),p(g)),e=!1,t.each(f,function(t,i){c=g.css(t),b.parseValue(c)!=b.parseValue(i)&&(e=!0),g.css(t,c)}),e?(n=[],a=m.easing in l?l[m.easing]:l._default,o=" "+m.duration+"ms cubic-bezier("+a.join(",")+")",void i.setTimeout(function(){g.one(u,function(t){return function(){p(t),m.complete.call(t[0])}}(g)),w.WEBKIT&&w.TOUCH&&(r={},s=[0,0,0],t.each(["left","top"],function(t,e){e in f&&(s[t]=b.parseValue(f[e])-b.parseValue(g.css(e))+"px",r[e]=f[e],delete f[e])}),(s[0]||s[1])&&(g.data("revert",r),n.push("-webkit-transform"+o),d(g,"translate3d("+s.join(",")+")","transform"))),t.each(f,function(t){n.push(t+o)}),d(g,n.join(",")),g.css(f)},1)):void i.setTimeout(function(){m.complete.call(g[0])},m.duration)):void g.animate(f,m):(g.css(f),void m.complete.call(g[0]))}}(),forceStyles:function(e,i){e=t(e),e.attr("style")&&e.data("styles",e.attr("style")).removeAttr("style"),e.css(i)},revertStyles:function(){t.each(b.array(arguments),function(e,i){i=t(i),i.removeAttr("style"),i.attr("style",""),i.data("styles")&&i.attr("style",i.data("styles")).data("styles",null)})},moveOut:function(t){b.forceStyles(t,{position:"absolute",left:-1e4})},moveIn:function(){b.revertStyles.apply(b,b.array(arguments))},hide:function(e,i,n){e=t(e),e.data("opacity")||e.data("opacity",e.css("opacity"));var a={opacity:0};i?b.animate(e,a,{duration:i,complete:n,stop:!0}):e.css(a)},show:function(e,i,n){e=t(e);var a=parseFloat(e.data("opacity"))||1,o={opacity:a};i?b.animate(e,o,{duration:i,complete:n,stop:!0}):e.css(o)},optimizeTouch:function(){var e,i,n,a,o={},r=function(e){e.preventDefault(),o=t.extend({},e,!0)},s=function(){this.evt=o},c=function(){this.handler.call(e,this.evt)};return function(o){t(o).bind("touchstart",function(o){for(e=o.target,a=!0;e.parentNode&&e!=o.currentTarget&&a;)i=t(e).data("events"),n=t(e).data("fakes"),i&&"click"in i?(a=!1,o.preventDefault(),t(e).click(r).click(),i.click.pop(),t.each(i.click,s),t(e).data("fakes",i.click),delete i.click):n&&(a=!1,o.preventDefault(),t.each(n,c)),e=e.parentNode})}}(),addTimer:function(){return f.add.apply(f,b.array(arguments)),this},clearTimer:function(){return f.clear.apply(f,b.array(arguments)),this},wait:function(e){e=t.extend({until:function(){return!1},success:function(){},error:function(){w.raise("Could not complete wait function.")},timeout:3e3},e);var n,a,o=b.timestamp(),r=function(){return a=b.timestamp(),n=a-o,e.until(n)?(e.success(),!1):a>=o+e.timeout?(e.error(),!1):void i.setTimeout(r,2)};i.setTimeout(r,2)},toggleQuality:function(t,e){7!==h&&8!==h||!t||("undefined"==typeof e&&(e="nearest-neighbor"===t.style.msInterpolationMode),t.style.msInterpolationMode=e?"bicubic":"nearest-neighbor")},insertStyleTag:function(t){var e=n.createElement("style");if(u().head.appendChild(e),e.styleSheet)e.styleSheet.cssText=t;else{var i=n.createTextNode(t);e.appendChild(i)}},loadScript:function(e,i){var n=!1,a=t("<script>").attr({src:e,async:!0}).get(0);a.onload=a.onreadystatechange=function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,a.onload=a.onreadystatechange=null,"function"==typeof i&&i.call(this,this))},u().head.appendChild(a)},parseValue:function(t){if("number"==typeof t)return t;if("string"==typeof t){var e=t.match(/\-?\d|\./g);return e&&e.constructor===Array?1*e.join(""):0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(a,o,s){var c,l,d=!1;return t("link[rel=stylesheet]").each(function(){return new RegExp(a).test(this.href)?(c=this,!1):void 0}),"function"==typeof o&&(s=o,o=e),s=s||function(){},c?(s.call(c,c),c):(l=n.styleSheets.length,r&&(a+="?"+b.timestamp()),t("#"+o).length?(t("#"+o).attr("href",a),l--,d=!0):(c=t("<link>").attr({rel:"stylesheet",href:a,id:o}).get(0),i.setTimeout(function(){var e=t('link[rel="stylesheet"], style');if(e.length?e.get(0).parentNode.insertBefore(c,e[0]):u().head.appendChild(c),h){if(l>=31)return void w.raise("You have reached the browser stylesheet limit (31)",!0);c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0)}}else new RegExp("file://","i").test(a)?d=!0:t.ajax({url:a,success:function(){d=!0},error:function(t){t.isRejected()&&w.WEBKIT&&(d=!0)}})},10)),"function"==typeof s&&b.wait({until:function(){return d&&n.styleSheets.length>l},success:function(){i.setTimeout(function(){s.call(c,c)},100)},error:function(){w.raise("Theme CSS could not load",!0)},timeout:1e4}),c)}}}(),x=function(){var e=function(e,i,n,a){var o=this.getOptions("easing"),r=this.getStageWidth(),s={left:r*(e.rewind?-1:1)},c={left:0};n&&(s.opacity=0,c.opacity=1),t(e.next).css(s),b.animate(e.next,c,{duration:e.speed,complete:function(t){return function(){i(),t.css({left:0})}}(t(e.next).add(e.prev)),queue:!1,easing:o}),a&&(e.rewind=!e.rewind),e.prev&&(s={left:0},c={left:r*(e.rewind?1:-1)},n&&(s.opacity=1,c.opacity=0),t(e.prev).css(s),b.animate(e.prev,c,{duration:e.speed,queue:!1,easing:o,complete:function(){t(this).css("opacity",0)}}))};return{fade:function(e,i){t(e.next).css("opacity",0).show(),b.animate(e.next,{opacity:1},{duration:e.speed,complete:i}),e.prev&&(t(e.prev).css("opacity",1).show(),b.animate(e.prev,{opacity:0},{duration:e.speed}))},flash:function(e,i){t(e.next).css("opacity",0),e.prev?b.animate(e.prev,{opacity:0},{duration:e.speed/2,complete:function(){b.animate(e.next,{opacity:1},{duration:e.speed,complete:i})}}):b.animate(e.next,{opacity:1},{duration:e.speed,complete:i})},pulse:function(e,i){e.prev&&t(e.prev).hide(),t(e.next).css("opacity",0).show(),b.animate(e.next,{opacity:1},{duration:e.speed,complete:i})},slide:function(){e.apply(this,b.array(arguments))},fadeslide:function(){e.apply(this,b.array(arguments).concat([!0]))},doorslide:function(){e.apply(this,b.array(arguments).concat([!1,!0]))}}}(),w=function(){var n=this;this._theme=e,this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=e,this._id=Math.random();var r="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",s="current total";t.each(r.split(" "),function(t,e){n._dom[e]=b.create("galleria-"+e)}),t.each(s.split(" "),function(t,e){n._dom[e]=b.create("galleria-"+e,"span")});var c=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;e in c.map&&"function"==typeof c.map[e]&&c.map[e].call(n,t)},attach:function(t){var e,i;for(e in t)t.hasOwnProperty(e)&&(i=e.toUpperCase(),i in c.keys?c.map[c.keys[i]]=t[e]:c.map[i]=t[e]);c.bound||(c.bound=!0,a.bind("keydown",c.press))},detach:function(){c.bound=!1,c.map={},a.unbind("keydown",c.press)}},l=this._controls={0:e,1:e,active:0,swap:function(){l.active=l.active?0:1},getActive:function(){return l[l.active]},getNext:function(){return l[1-l.active]}},d=this._carousel={next:n.$("thumb-nav-right"),prev:n.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var e=0,i=0,a=[0];t.each(n._thumbnails,function(n,o){o.ready&&(e+=o.outerWidth||t(o.container).outerWidth(!0),a[n+1]=e,i=Math.max(i,o.outerHeight||t(o.container).outerHeight(!0)))}),n.$("thumbnails").css({width:e,height:i}),d.max=e,d.hooks=a,d.width=n.$("thumbnails-list").width(),d.setClasses(),n.$("thumbnails-container").toggleClass("galleria-carousel",e>d.width),d.width=n.$("thumbnails-list").width()},bindControls:function(){var t;d.next.bind("click",function(e){if(e.preventDefault(),"auto"===n._options.carouselSteps){for(t=d.current;t<d.hooks.length;t++)if(d.hooks[t]-d.hooks[d.current]>d.width){d.set(t-2);break}}else d.set(d.current+n._options.carouselSteps)}),d.prev.bind("click",function(e){if(e.preventDefault(),"auto"===n._options.carouselSteps)for(t=d.current;t>=0;t--){if(d.hooks[d.current]-d.hooks[t]>d.width){d.set(t+2);break}if(0===t){d.set(0);break}}else d.set(d.current-n._options.carouselSteps)})},set:function(t){for(t=Math.max(t,0);d.hooks[t-1]+d.width>=d.max&&t>=0;)t--;d.current=t,d.animate()},getLast:function(t){return(t||d.current)-1},follow:function(t){if(0===t||t===d.hooks.length-2)return void d.set(t);for(var e=d.current;d.hooks[e]-d.hooks[d.current]<d.width&&e<=d.hooks.length;)e++;t-1<d.current?d.set(t-1):t+2>e&&d.set(t-e+d.current+2)},setClasses:function(){d.prev.toggleClass("disabled",!d.current),d.next.toggleClass("disabled",d.hooks[d.current]+d.width>=d.max)},animate:function(){d.setClasses();var t=-1*d.hooks[d.current];isNaN(t)||b.animate(n.get("thumbnails"),{left:t},{duration:n._options.carouselSpeed,easing:n._options.easing,queue:!1})}},p=this._tooltip={initialized:!1,open:!1,init:function(){p.initialized=!0;var t=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";b.insertStyleTag(t),n.$("tooltip").css("opacity",.8),b.hide(n.get("tooltip"))},move:function(t){var e=n.getMousePosition(t).x,i=n.getMousePosition(t).y,a=n.$("tooltip"),o=e,r=i,s=a.outerHeight(!0)+1,c=a.outerWidth(!0),h=s+15,u=n.$("container").width()-c-2,l=n.$("container").height()-s-2;isNaN(o)||isNaN(r)||(o+=10,r-=30,o=Math.max(0,Math.min(u,o)),r=Math.max(0,Math.min(l,r)),h>i&&(r=h),a.css({left:o,top:r}))},bind:function(e,i){if(!w.TOUCH){p.initialized||p.init();var a=function(e,i){p.define(e,i),t(e).hover(function(){b.clearTimer("switch_tooltip"),n.$("container").unbind("mousemove",p.move).bind("mousemove",p.move).trigger("mousemove"),p.show(e),w.utils.addTimer("tooltip",function(){n.$("tooltip").stop().show().animate({opacity:1}),p.open=!0},p.open?0:500)},function(){n.$("container").unbind("mousemove",p.move),b.clearTimer("tooltip"),n.$("tooltip").stop().animate({opacity:0},200,function(){n.$("tooltip").hide(),b.addTimer("switch_tooltip",function(){p.open=!1},1e3)})})};"string"==typeof i?a(e in n._dom?n.get(e):e,i):t.each(e,function(t,e){a(n.get(t),e)})}},show:function(e){e=t(e in n._dom?n.get(e):e);var a=e.data("tt"),o=function(t){i.setTimeout(function(t){return function(){p.move(t)}}(t),10),e.unbind("mouseup",o)};a="function"==typeof a?a():a,a&&(n.$("tooltip").html(a.replace(/\s/,"&nbsp;")),e.bind("mouseup",o))},define:function(e,i){if("function"!=typeof i){var a=i;i=function(){return a}}e=t(e in n._dom?n.get(e):e).data("tt",i),p.show(e)}},g=this._fullscreen={scrolled:0,active:!1,keymap:n._keyboard.map,enter:function(e){g.active=!0,b.hide(n.getActiveImage()),n.$("container").addClass("fullscreen"),g.scrolled=o.scrollTop(),b.forceStyles(n.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4});var i={height:"100%",overflow:"hidden",margin:0,padding:0},a=n.getData();if(b.forceStyles(u().html,i),b.forceStyles(u().body,i),g.keymap=t.extend({},n._keyboard.map),n.attachKeyboard({escape:n.exitFullscreen,right:n.next,left:n.prev}),a&&a.big&&a.image!==a.big){var r=new w.Picture,s=r.isCached(a.big),c=n.getIndex(),h=n._thumbnails[c];n.trigger({type:w.LOADSTART,cached:s,index:c,imageTarget:n.getActiveImage(),thumbTarget:h}),r.load(a.big,function(e){n._scaleImage(e,{complete:function(e){n.trigger({type:w.LOADFINISH,cached:s,index:c,imageTarget:e.image,thumbTarget:h});var i=n._controls.getActive().image;i&&t(i).width(e.image.width).height(e.image.height).attr("style",t(e.image).attr("style")).attr("src",e.image.src)}})})}n.rescale(function(){b.addTimer("fullscreen_enter",function(){b.show(n.getActiveImage()),"function"==typeof e&&e.call(n)},100),n.trigger(w.FULLSCREEN_ENTER)}),o.resize(function(){g.scale()})},scale:function(){n.rescale()},exit:function(t){g.active=!1,b.hide(n.getActiveImage()),n.$("container").removeClass("fullscreen"),b.revertStyles(n.get("container"),u().html,u().body),i.scrollTo(0,g.scrolled),n.detachKeyboard(),n.attachKeyboard(g.keymap),n.rescale(function(){b.addTimer("fullscreen_exit",function(){b.show(n.getActiveImage()),"function"==typeof t&&t.call(n)},50),n.trigger(w.FULLSCREEN_EXIT)}),o.unbind("resize",g.scale)}},f=this._idle={trunk:[],bound:!1,add:function(e,i){if(e){f.bound||f.addEvent(),e=t(e);var n,a={};for(n in i)i.hasOwnProperty(n)&&(a[n]=e.css(n));e.data("idle",{from:a,to:i,complete:!0,busy:!1}),f.addTimer(),f.trunk.push(e)}},remove:function(e){e=jQuery(e),t.each(f.trunk,function(t,i){i.length&&!i.not(e).length&&(n._idle.show(e),n._idle.trunk.splice(t,1))}),f.trunk.length||(f.removeEvent(),b.clearTimer("idle"))},addEvent:function(){f.bound=!0,n.$("container").bind("mousemove click",f.showAll)},removeEvent:function(){f.bound=!1,n.$("container").unbind("mousemove click",f.showAll)},addTimer:function(){b.addTimer("idle",function(){n._idle.hide()},n._options.idleTime)},hide:function(){n._options.idleMode&&(n.trigger(w.IDLE_ENTER),t.each(f.trunk,function(t,e){var i=e.data("idle");i&&(e.data("idle").complete=!1,b.animate(e,i.to,{duration:n._options.idleSpeed}))}))},showAll:function(){b.clearTimer("idle"),t.each(n._idle.trunk,function(t,e){n._idle.show(e)})},show:function(e){var i=e.data("idle");i.busy||i.complete||(i.busy=!0,n.trigger(w.IDLE_EXIT),b.clearTimer("idle"),b.animate(e,i.from,{duration:n._options.idleSpeed/2,complete:function(){t(this).data("idle").busy=!1,t(this).data("idle").complete=!0}})),f.addTimer()}},m=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(n.trigger(w.LIGHTBOX_OPEN),!m.initialized){m.initialized=!0;var e="overlay box content shadow title info close prevholder prev nextholder next counter image",i={},a=n._options,o="",r="position:absolute;",s="lightbox-",c={overlay:"position:fixed;display:none;opacity:"+a.overlayOpacity+";filter:alpha(opacity="+100*a.overlayOpacity+");top:0;left:0;width:100%;height:100%;background:"+a.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:r+"background:#000;width:100%;height:100%;",content:r+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:r+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:r+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:r+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:r+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:r+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:r+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:r+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},l=function(e){return e.hover(function(){t(this).css("color","#bbb")},function(){t(this).css("color","#444")})},d={};8===h&&(c.nextholder+="background:#000;filter:alpha(opacity=0);",c.prevholder+="background:#000;filter:alpha(opacity=0);"),t.each(c,function(t,e){o+=".galleria-"+s+t+"{"+e+"}"}),b.insertStyleTag(o),t.each(e.split(" "),function(t,e){n.addElement("lightbox-"+e),i[e]=m.elems[e]=n.get("lightbox-"+e)}),m.image=new w.Picture,t.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(e,i){var n=[];t.each(i.split(" "),function(t,e){n.push(s+e)}),d[s+e]=n}),n.append(d),t(i.image).append(m.image.container),t(u().body).append(i.overlay,i.box),b.optimizeTouch(i.box),l(t(i.close).bind("click",m.hide).html("&#215;")),t.each(["Prev","Next"],function(e,n){var a=t(i[n.toLowerCase()]).html(/v/.test(n)?"&#8249;&nbsp;":"&nbsp;&#8250;"),o=t(i[n.toLowerCase()+"holder"]);return o.bind("click",function(){m["show"+n]()}),8>h||w.TOUCH?void a.show():void o.hover(function(){a.show()},function(){a.stop().fadeOut(200)})}),t(i.overlay).bind("click",m.hide),w.IPAD&&(n._options.lightboxTransitionSpeed=0)}},rescale:function(e){var i=Math.min(o.width()-40,m.width),a=Math.min(o.height()-60,m.height),r=Math.min(i/m.width,a/m.height),s=Math.round(m.width*r)+40,c=Math.round(m.height*r)+60,h={width:s,height:c,"margin-top":-1*Math.ceil(c/2),"margin-left":-1*Math.ceil(s/2)};e?t(m.elems.box).css(h):t(m.elems.box).animate(h,{duration:n._options.lightboxTransitionSpeed,easing:n._options.easing,complete:function(){var e=m.image,i=n._options.lightboxFadeSpeed;n.trigger({type:w.LIGHTBOX_IMAGE,imageTarget:e.image}),t(e.container).show(),b.show(e.image,i),b.show(m.elems.info,i)}})},hide:function(){m.image.image=null,o.unbind("resize",m.rescale),t(m.elems.box).hide(),b.hide(m.elems.info),n.detachKeyboard(),n.attachKeyboard(m.keymap),m.keymap=!1,b.hide(m.elems.overlay,200,function(){t(this).hide().css("opacity",n._options.overlayOpacity),n.trigger(w.LIGHTBOX_CLOSE)})},showNext:function(){m.show(n.getNext(m.active))},showPrev:function(){m.show(n.getPrev(m.active))},show:function(e){m.active=e="number"==typeof e?e:n.getIndex(),m.initialized||m.init(),m.keymap||(m.keymap=t.extend({},n._keyboard.map),n.attachKeyboard({escape:m.hide,right:m.showNext,left:m.showPrev})),o.unbind("resize",m.rescale);var i=n.getData(e),a=n.getDataLength();b.hide(m.elems.info),m.image.load(i.big||i.image,function(n){m.width=n.original.width,m.height=n.original.height,t(n.image).css({width:"100.5%",height:"100.5%",top:0,zIndex:99998}),b.hide(n.image),m.elems.title.innerHTML=i.title||"",m.elems.counter.innerHTML=e+1+" / "+a,o.resize(m.rescale),m.rescale()}),t(m.elems.overlay).show(),t(m.elems.box).show()}};return this};w.prototype={constructor:w,init:function(i,n){var a=this;return n=p(n),this._original={target:i,options:n,data:null},this._target=this._dom.target=i.nodeName?i:t(i).get(0),y.push(this),this._target?(this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dataConfig:function(){return{}},dataSelector:"img",dataSource:this._target,debug:e,easing:"galleria",extend:function(){},fullscreenDoubleTap:!0,height:"auto",idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",initialTransition:e,keepSource:!1,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceTmages:!0,maxScaleRatio:e,minScaleRatio:e,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,protect:!1,queue:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:!0,thumbCrop:!0,thumbEventType:"click",thumbFit:!0,thumbMargin:0,thumbQuality:"auto",thumbnails:!0,transition:"fade",transitionInitial:e,transitionSpeed:400,useCanvas:!1,width:"auto"},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,n&&n.debug===!1&&(r=!1),t(this._target).children().hide(),void("object"==typeof w.theme?this._init():b.wait({until:function(){return"object"==typeof w.theme},success:function(){a._init.call(a)},error:function(){w.raise("No theme found.",!0)},timeout:5e3}))):void w.raise("Target not found.",!0)},_init:function(){var e=this;return this._initialized?(w.raise("Init failed: Gallery instance already initialized."),this):(this._initialized=!0,w.theme?(t.extend(!0,this._options,w.theme.defaults,this._original.options),function(t){return"getContext"in t?void(_=_||{elem:t,context:t.getContext("2d"),cache:{},length:0}):void(t=null)}(n.createElement("canvas")),this.bind(w.DATA,function(){this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var n=this.$("container"),a={width:0,height:0},o=function(){return e.$("stage").height()};b.wait({until:function(){return t.each(["width","height"],function(t,i){a[i]=e._options[i]&&"number"==typeof e._options[i]?e._options[i]:Math.max(b.parseValue(n.css(i)),b.parseValue(e.$("target").css(i)),n[i](),e.$("target")[i]()),n[i](a[i])}),o()&&a.width&&a.height>10},success:function(){w.WEBKIT?i.setTimeout(function(){e._run()},1):e._run()},error:function(){o()?w.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+a.width+"px, height: "+a.height+"px.",!0):w.raise("Could not extract a stage height from the CSS. Traced height: "+o()+"px.",!0)},timeout:2e3})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),b.hide(this.$("counter").append(this.get("current")," / ",this.get("total"))),this.setCounter("&#8211;"),b.hide(e.get("tooltip")),this.$("container").addClass(w.TOUCH?"touch":"notouch"),t.each(new Array(2),function(i){var n=new w.Picture;t(n.container).css({position:"absolute",top:0,left:0}),e.$("images").append(n.container),e._controls[i]=n}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").bind("click",function(t){e._options.clicknext&&t.stopPropagation(),e._options.pauseOnInteraction&&e.pause();var i=/right/.test(this.className)?"next":"prev";e[i]()}),t.each(["info","counter","image-nav"],function(t,i){e._options["show"+i.substr(0,1).toUpperCase()+i.substr(1).replace(/-/,"")]===!1&&b.moveOut(e.get(i.toLowerCase()))}),this.load(),this._options.keep_source||h||(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container"),this._options.carousel&&this.bind(w.THUMBNAIL,function(){this.updateCarousel()}),this._options.swipe&&(!function(t){var i,n=[0,0],a=[0,0],o=30,r=100,s=!1,c=0,h={start:"touchstart",move:"touchmove",stop:"touchend"},u=function(t){return t.originalEvent.touches?t.originalEvent.touches[0]:t},l=function(t){t.originalEvent.touches&&t.originalEvent.touches.length>1||(i=u(t),a=[i.pageX,i.pageY],n[0]||(n=a),Math.abs(n[0]-a[0])>10&&t.preventDefault())},d=function(i){return t.unbind(h.move,l),i.originalEvent.touches&&i.originalEvent.touches.length||s?void(s=!s):(b.timestamp()-c<1e3&&Math.abs(n[0]-a[0])>o&&Math.abs(n[1]-a[1])<r&&(i.preventDefault(),e[n[0]>a[0]?"next":"prev"]()),void(n=a=[0,0]))};t.bind(h.start,function(e){e.originalEvent.touches&&e.originalEvent.touches.length>1||(i=u(e),c=b.timestamp(),n=a=[i.pageX,i.pageY],t.bind(h.move,l).one(h.stop,d))})}(e.$("images")),this._options.fullscreenDoubleTap&&this.$("stage").bind("touchstart",function(){var t,i,n,a,o,r,s=function(t){return t.originalEvent.touches?t.originalEvent.touches[0]:t};return function(c){return r=w.utils.timestamp(),i=s(c).pageX,n=s(c).pageY,500>r-t&&20>i-a&&20>n-o?(e.toggleFullscreen(),c.preventDefault(),void e.$("stage").unbind("touchend",arguments.callee)):(t=r,a=i,void(o=n))}}())),b.optimizeTouch(this.get("container")),this):(w.raise("Init failed: No theme found."),this))},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var e,a,o,r,s,c=this,h=this._options,u=function(){var t=c.$("thumbnails").find(".active");return t.length?t.find("img").attr("src"):!1}(),l="string"==typeof h.thumbnails?h.thumbnails.toLowerCase():null,d=function(t){return n.defaultView&&n.defaultView.getComputedStyle?n.defaultView.getComputedStyle(o.container,null)[t]:s.css(t)},p=function(e,i,n){return function(){t(n).append(e),c.trigger({type:w.THUMBNAIL,thumbTarget:e,index:i})}},g=function(e){h.pauseOnInteraction&&c.pause();var i=t(e.currentTarget).data("index");c.getIndex()!==i&&c.show(i),e.preventDefault()},f=function(e){e.scale({width:e.data.width,height:e.data.height,crop:h.thumbCrop,margin:h.thumbMargin,canvas:h.useCanvas,complete:function(e){var i,n,a=["left","top"],o=["Width","Height"];t.each(o,function(o,r){i=r.toLowerCase(),h.thumbCrop===!0&&h.thumbCrop!==i||!h.thumbFit||(n={},n[i]=e[i],t(e.container).css(n),n={},n[a[o]]=0,t(e.image).css(n)),e["outer"+r]=t(e.container)["outer"+r](!0)}),b.toggleQuality(e.image,h.thumbQuality===!0||"auto"===h.thumbQuality&&e.original.width<3*e.width),c.trigger({type:w.THUMBNAIL,thumbTarget:e.image,index:e.data.order})}})};for(this._thumbnails=[],this.$("thumbnails").empty(),e=0;this._data[e];e++)r=this._data[e],h.thumbnails===!0?(o=new w.Picture(e),a=r.thumb||r.image,this.$("thumbnails").append(o.container),s=t(o.container),o.data={width:b.parseValue(d("width")),height:b.parseValue(d("height")),order:e},s.css(h.thumbFit&&h.thumbCrop!==!0?{width:0,height:0}:{width:o.data.width,height:o.data.height}),o.load(a,f),"all"===h.preload&&o.add(r.image)):"empty"===l||"numbers"===l?(o={container:b.create("galleria-image"),image:b.create("img","span"),ready:!0},"numbers"===l&&t(o.image).text(e+1),this.$("thumbnails").append(o.container),i.setTimeout(p(o.image,e,o.container),50+20*e)):o={container:null,image:null},t(o.container).add(h.keepSource&&h.linkSourceImages?r.original:null).data("index",e).bind(h.thumbEventType,g),u===a&&t(o.container).addClass("active"),this._thumbnails.push(o)},_run:function(){var n=this;n._createThumbnails(),b.wait({until:function(){return w.OPERA&&n.$("stage").css("display","inline-block"),n._stageWidth=n.$("stage").width(),n._stageHeight=n.$("stage").height(),n._stageWidth&&n._stageHeight>50},success:function(){return m.push(n),b.show(n.get("counter")),n._options.carousel&&n._carousel.bindControls(),n._options.autoplay&&(n.pause(),"number"==typeof n._options.autoplay&&(n._playtime=n._options.autoplay),n.trigger(w.PLAY),n._playing=!0),n._firstrun?void("number"==typeof n._options.show&&n.show(n._options.show)):(n._firstrun=!0,n._options.clicknext&&!w.TOUCH&&(t.each(n._data,function(t,e){delete e.link}),n.$("stage").css({cursor:"pointer"}).bind("click",function(){n._options.pauseOnInteraction&&n.pause(),n.next()})),w.History&&w.History.change(function(t){var a=parseInt(t.value.replace(/\//,""),10);isNaN(a)?i.history.go(-1):n.show(a,e,!0)}),t.each(w.ready.callbacks,function(){this.call(n,n._options)}),n.trigger(w.READY),w.theme.init.call(n,n._options),n._options.extend.call(n,n._options),void(/^[0-9]{1,4}$/.test(c)&&w.History?n.show(c,e,!0):n._data[n._options.show]&&n.show(n._options.show)))},error:function(){w.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+n._stageWidth+"px, height: "+n._stageHeight+"px.",!0)}})},load:function(e,i,n){var a=this;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),"function"==typeof i&&(n=i,i=null),e=e||this._options.dataSource,i=i||this._options.dataSelector,n=n||this._options.dataConfig,/^function Object/.test(e.constructor)&&(e=[e]),e.constructor===Array?(this.validate(e)?(this._data=e,this._parseData().trigger(w.DATA)):w.raise("Load failed: JSON Array not valid."),this):(t(e).find(i).each(function(e,i){i=t(i);var o={},r=i.parent(),s=r.attr("href"),c=r.attr("rel"),h=/\.(png|gif|jpg|jpeg)(\?.*)?$/i;h.test(s)?(o.image=s,o.big=h.test(c)?c:s):s&&(o.link=s),a._data.push(t.extend({title:i.attr("title")||"",thumb:i.attr("src"),image:i.attr("src"),big:i.attr("src"),description:i.attr("alt")||"",link:i.attr("longdesc"),original:i.get(0)},o,n(i)))}),this.getDataLength()?this.trigger(w.DATA):w.raise("Load failed: no data found."),this)},_parseData:function(){var e=this;return t.each(this._data,function(t,i){"thumb"in i==!1&&(e._data[t].thumb=i.image),!1 in i&&(e._data[t].big=i.image)}),this},splice:function(){return Array.prototype.splice.apply(this._data,b.array(arguments)),this._parseData()._createThumbnails()},push:function(){return Array.prototype.push.apply(this._data,b.array(arguments)),this._parseData()._createThumbnails()},_getActive:function(){return this._controls.getActive()},validate:function(){return!0},bind:function(t,e){return t=g(t),this.$("container").bind(t,this.proxy(e)),this},unbind:function(t){return t=g(t),this.$("container").unbind(t),this},trigger:function(e){return e="object"==typeof e?t.extend(e,{scope:this}):{type:g(e),scope:this},this.$("container").trigger(e),this},addIdleState:function(){return this._idle.add.apply(this._idle,b.array(arguments)),this},removeIdleState:function(){return this._idle.remove.apply(this._idle,b.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(){return this._fullscreen.enter.apply(this,b.array(arguments)),this},exitFullscreen:function(){return this._fullscreen.exit.apply(this,b.array(arguments)),this},toggleFullscreen:function(){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,b.array(arguments)),this},bindTooltip:function(){return this._tooltip.bind.apply(this._tooltip,b.array(arguments)),this},defineTooltip:function(){return this._tooltip.define.apply(this._tooltip,b.array(arguments)),this},refreshTooltip:function(){return this._tooltip.show.apply(this._tooltip,b.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,b.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,b.array(arguments)),this
},getActiveImage:function(){return this._getActive().image||e},getActiveThumb:function(){return this._thumbnails[this._active].image||e},getMousePosition:function(t){return{x:t.pageX-this.$("container").offset().left,y:t.pageY-this.$("container").offset().top}},addPan:function(e){if(this._options.imageCrop!==!1){e=t(e||this.getActiveImage());var i=this,n=e.width()/2,a=e.height()/2,o=parseInt(e.css("left"),10),r=parseInt(e.css("top"),10),s=o||0,c=r||0,u=0,l=0,d=!1,p=b.timestamp(),g=0,f=0,m=function(t,i,n){if(t>0&&(f=Math.round(Math.max(-1*t,Math.min(0,i))),g!==f))if(g=f,8===h)e.parent()["scroll"+n](-1*f);else{var a={};a[n.toLowerCase()]=f,e.css(a)}},y=function(t){b.timestamp()-p<50||(d=!0,n=i.getMousePosition(t).x,a=i.getMousePosition(t).y)},v=function(){d&&(u=e.width()-i._stageWidth,l=e.height()-i._stageHeight,o=n/i._stageWidth*u*-1,r=a/i._stageHeight*l*-1,s+=(o-s)/i._options.imagePanSmoothness,c+=(r-c)/i._options.imagePanSmoothness,m(l,c,"Top"),m(u,s,"Left"))};return 8===h&&(e.parent().scrollTop(-1*c).scrollLeft(-1*s),e.css({top:0,left:0})),this.$("stage").unbind("mousemove",y).bind("mousemove",y),b.addTimer("pan",v,50,!0),this}},proxy:function(t,e){return"function"!=typeof t?function(){}:(e=e||this,function(){return t.apply(e,b.array(arguments))})},removePan:function(){return this.$("stage").unbind("mousemove"),b.clearTimer("pan"),this},addElement:function(){var e=this._dom;return t.each(b.array(arguments),function(t,i){e[i]=b.create("galleria-"+i)}),this},attachKeyboard:function(){return this._keyboard.attach.apply(this._keyboard,b.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,b.array(arguments)),this},appendChild:function(t,e){return this.$(t).append(this.get(e)||e),this},prependChild:function(t,e){return this.$(t).prepend(this.get(e)||e),this},remove:function(){return this.$(b.array(arguments).join(",")).remove(),this},append:function(t){var e,i;for(e in t)if(t.hasOwnProperty(e))if(t[e].constructor===Array)for(i=0;t[e][i];i++)this.appendChild(e,t[e][i]);else this.appendChild(e,t[e]);return this},_scaleImage:function(e,i){return i=t.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},i),(e||this._controls.getActive()).scale(i),this},updateCarousel:function(){return this._carousel.update(),this},rescale:function(t,i,n){var a=this;"function"==typeof t&&(n=t,t=e);var o=function(){a._stageWidth=t||a.$("stage").width(),a._stageHeight=i||a.$("stage").height(),a._scaleImage(),a._options.carousel&&a.updateCarousel(),a.trigger(w.RESCALE),"function"==typeof n&&n.call(a)};return!w.WEBKIT||t||i?o.call(a):b.addTimer("scale",o,10),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},show:function(t,e,i){return t===!1||!this._options.queue&&this._queue.stalled?void 0:(t=Math.max(0,Math.min(parseInt(t,10),this.getDataLength()-1)),e="undefined"!=typeof e?!!e:t<this.getIndex(),i=i||!1,!i&&w.History?void w.History.value(t.toString()):(this._active=t,Array.prototype.push.call(this._queue,{index:t,rewind:e}),this._queue.stalled||this._show(),this))},_show:function(){var n=this,a=this._queue[0],o=this.getData(a.index);if(o){var r=this.isFullscreen()&&"big"in o?o.big:o.image,s=this._controls.getActive(),c=this._controls.getNext(),h=c.isCached(r),u=this._thumbnails[a.index],l=function(e,a,o,r,s){return function(){var c;n._queue.stalled=!1,b.toggleQuality(a.image,n._options.imageQuality),t(o.container).css({zIndex:0,opacity:0}).show(),t(a.container).css({zIndex:1,opacity:1}).show(),n._controls.swap(),n._options.imagePan&&n.addPan(a.image),(e.link||n._options.lightbox)&&t(a.image).css({cursor:"pointer"}).bind("mouseup",function(){return e.link?void(n._options.popupLinks?c=i.open(e.link,"_blank"):i.location.href=e.link):void n.openLightbox()}),Array.prototype.shift.call(n._queue),n._queue.length&&n._show(),n._playCheck(),n.trigger({type:w.IMAGE,index:r.index,imageTarget:a.image,thumbTarget:s.image})}}(o,c,s,a,u);if(this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(a.index),this._options.preload){var d,p,g,f=this.getNext();try{for(p=this._options.preload;p>0;p--)d=new w.Picture,g=n.getData(f),d.add(this.isFullscreen()&&"big"in g?g.big:g.image),f=n.getNext(f)}catch(m){}}b.show(c.container),t(n._thumbnails[a.index].container).addClass("active").siblings(".active").removeClass("active"),n.trigger({type:w.LOADSTART,cached:h,index:a.index,imageTarget:c.image,thumbTarget:u.image}),c.load(r,function(t){n._scaleImage(t,{complete:function(t){"image"in s&&b.toggleQuality(s.image,!1),b.toggleQuality(t.image,!1),n._queue.stalled=!0,n.removePan(),n.setInfo(a.index),n.setCounter(a.index),n.trigger({type:w.LOADFINISH,cached:h,index:a.index,imageTarget:t.image,thumbTarget:n._thumbnails[a.index].image});var i=null===s.image&&n._options.initialTransition!==e?n._options.initialTransition:n._options.transition;if(i in x==!1)l();else{var o={prev:s.container,next:t.container,rewind:a.rewind,speed:n._options.transitionSpeed||400};x[i].call(n,o,l)}}})})}},getNext:function(t){return t="number"==typeof t?t:this.getIndex(),t===this.getDataLength()-1?0:t+1},getPrev:function(t){return t="number"==typeof t?t:this.getIndex(),0===t?this.getDataLength()-1:t-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(t){return t in this._dom?this._dom[t]:null},getData:function(t){return t in this._data?this._data[t]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return"number"==typeof this._active?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(t){return"undefined"==typeof t?this._options:this._options[t]},setOptions:function(e,i){return"object"==typeof e?t.extend(this._options,e):this._options[e]=i,this},play:function(t){return this._playing=!0,this._playtime=t||this._playtime,this._playCheck(),this.trigger(w.PLAY),this},pause:function(){return this._playing=!1,this.trigger(w.PAUSE),this},playToggle:function(t){return this._playing?this.pause():this.play(t)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var t=this,e=0,i=20,n=b.timestamp(),a="play"+this._id;if(this._playing){b.clearTimer(a);var o=function(){return e=b.timestamp()-n,e>=t._playtime&&t._playing?(b.clearTimer(a),void t.next()):void(t._playing&&(t.trigger({type:w.PROGRESS,percent:Math.ceil(e/t._playtime*100),seconds:Math.floor(e/1e3),milliseconds:e}),b.addTimer(a,o,i)))};b.addTimer(a,o,i)}},setIndex:function(t){return this._active=t,this},setCounter:function(t){if("number"==typeof t?t++:"undefined"==typeof t&&(t=this.getIndex()+1),this.get("current").innerHTML=t,h){var e=this.$("counter"),i=e.css("opacity"),n=e.attr("style");n&&1===parseInt(i,10)?e.attr("style",n.replace(/filter[^\;]+\;/i,"")):this.$("counter").css("opacity",i)}return this},setInfo:function(e){var i=this,n=this.getData(e);return t.each(["title","description"],function(t,e){var a=i.$("info-"+e);n[e]?a[n[e].length?"show":"hide"]().html(n[e]):a.empty().hide()}),this},hasInfo:function(t){var e,i="title description".split(" ");for(e=0;i[e];e++)if(this.getData(t)[i[e]])return!0;return!1},jQuery:function(e){var i=this,n=[];t.each(e.split(","),function(e,a){a=t.trim(a),i.get(a)&&n.push(a)});var a=t(i.get(n.shift()));return t.each(n,function(t,e){a=a.add(i.get(e))}),a},$:function(){return this.jQuery.apply(this,b.array(arguments))}},t.each(d,function(t,e){var i=/_/.test(e)?e.replace(/_/g,""):e;w[e.toUpperCase()]="galleria."+i}),t.extend(w,{IE9:9===h,IE8:8===h,IE7:7===h,IE6:6===h,IE:!!h,WEBKIT:/webkit/.test(s),SAFARI:/safari/.test(s),CHROME:/chrome/.test(s),QUIRK:h&&n.compatMode&&"BackCompat"===n.compatMode,MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!i.opera,IPHONE:/iphone/.test(s),IPAD:/ipad/.test(s),ANDROID:/android/.test(s),TOUCH:"ontouchstart"in document}),w.addTheme=function(e){e.name||w.raise("No theme name specified"),e.defaults="object"!=typeof e.defaults?{}:p(e.defaults);var i,n=!1;return"string"==typeof e.css?(t("link").each(function(t,a){return i=new RegExp(e.css),i.test(a.href)?(n=!0,w.theme=e,!1):void 0}),n||t("script").each(function(t,a){i=new RegExp("galleria\\."+e.name.toLowerCase()+"\\."),i.test(a.src)&&(n=a.src.replace(/[^\/]*$/,"")+e.css,b.addTimer("css",function(){b.loadCSS(n,"galleria-theme",function(){w.theme=e})},1))}),n||w.raise("No theme CSS loaded")):w.theme=e,e},w.loadTheme=function(i,n){var a=!1,o=m.length;w.theme=e,b.loadScript(i,function(){a=!0}),b.wait({until:function(){return a},error:function(){w.raise("Theme at "+i+" could not load, check theme path.",!0)},success:function(){if(o){var e=[];t.each(w.get(),function(i,a){var o=t.extend(a._original.options,{data_source:a._data},n);a.$("container").remove();var r=new w;r._id=a._id,r.init(a._original.target,o),e.push(r)}),m=e}},timeout:2e3})},w.get=function(t){return y[t]?y[t]:"number"!=typeof t?y:void w.raise("Gallery index "+t+" not found")},w.addTransition=function(t,e){x[t]=e},w.utils=b,w.log=function(){try{i.console.log.apply(i.console,b.array(arguments))}catch(t){try{i.opera.postError.apply(i.opera,arguments)}catch(e){i.alert(b.array(arguments).split(", "))}}},w.ready=function(t){w.ready.callbacks.push(t)},w.ready.callbacks=[],w.raise=function(e,i){var n=i?"Fatal error":"Error",a=function(e){var a='<div style="padding:4px;margin:0 0 2px;background:#'+(i?"811":"222")+'";>'+(i?"<strong>"+n+": </strong>":"")+e+"</div>";t.each(y,function(){var t=this.$("errors"),e=this.$("target");t.length||(e.css("position","relative"),t=this.addElement("errors").appendChild("target","errors").$("errors").css({color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5})),t.append(a)})};if(r){if(a(e),i)throw new Error(n+": "+e)}else if(i){if(v)return;v=!0,i=!1,a("Image gallery could not load.")}},w.Picture=function(e){this.id=e||null,this.image=null,this.container=b.create("galleria-image"),t(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.loaded=!1},w.Picture.prototype={cache:{},add:function(e){var i=0,n=this,a=new Image,o=function(){this.width&&this.height||!(1e3>i)||(i++,t(a).load(o).attr("src",e+"?"+(new Date).getTime())),n.original={height:this.height,width:this.width},n.cache[e]=e,n.loaded=!0};return t(a).css("display","block"),n.cache[e]?(a.src=e,o.call(a),a):(t(a).load(o).error(function(){w.raise("image could not load: "+e)}).attr("src",e),a)},show:function(){b.show(this.image)},hide:function(){b.moveOut(this.image)},clear:function(){this.image=null},isCached:function(t){return!!this.cache[t]},load:function(e,n){var a=this;return t(this.container).empty(!0),this.image=this.add(e),b.hide(this.image),t(this.container).append(this.image),b.wait({until:function(){return a.loaded&&a.image.complete&&a.original.width&&a.image.width},success:function(){i.setTimeout(function(){n.call(a,a)},1)},error:function(){i.setTimeout(function(){n.call(a,a)},1),w.raise("image not loaded in 30 seconds: "+e)},timeout:3e4}),this.container},scale:function(i){if(i=t.extend({width:0,height:0,min:e,max:e,margin:0,complete:function(){},position:"center",crop:!1,canvas:!1},i),!this.image)return this.container;var n,a,o,r=this,s=t(r.container);return b.wait({until:function(){return n=i.width||s.width()||b.parseValue(s.css("width")),a=i.height||s.height()||b.parseValue(s.css("height")),n&&a},success:function(){var e=(n-2*i.margin)/r.original.width,s=(a-2*i.margin)/r.original.height,c={"true":Math.max(e,s),width:e,height:s,"false":Math.min(e,s)},h=c[i.crop.toString()],u="";i.max&&(h=Math.min(i.max,h)),i.min&&(h=Math.max(i.min,h)),t.each(["width","height"],function(e,i){t(r.image)[i](r[i]=r.image[i]=Math.round(r.original[i]*h))}),t(r.container).width(n).height(a),i.canvas&&_&&(_.elem.width=r.width,_.elem.height=r.height,u=r.image.src+":"+r.width+"x"+r.height,r.image.src=_.cache[u]||function(t){_.context.drawImage(r.image,0,0,r.original.width*h,r.original.height*h);try{return o=_.elem.toDataURL(),_.length+=o.length,_.cache[t]=o,o}catch(e){return r.image.src}}(u));var l={},d={},p=function(e,i,n){var a=0;if(/\%/.test(e)){var o=parseInt(e,10)/100,s=r.image[i]||t(r.image)[i]();a=Math.ceil(-1*s*o+n*o)}else a=b.parseValue(e);return a},g={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};t.each(i.position.toLowerCase().split(" "),function(t,e){"center"===e&&(e="50%"),l[t?"top":"left"]=e}),t.each(l,function(e,i){g.hasOwnProperty(i)&&t.extend(d,g[i])}),l=l.top?t.extend(l,d):d,l=t.extend({top:"50%",left:"50%"},l),t(r.image).css({position:"relative",top:p(l.top,"height",a),left:p(l.left,"width",n)}),r.show(),r.ready=!0,i.complete.call(r,r)},error:function(){w.raise("Could not scale image: "+r.image.src)},timeout:1e3}),this}},t.extend(t.easing,{galleria:function(t,e,i,n,a){return(e/=a/2)<1?n/2*e*e*e+i:n/2*((e-=2)*e*e+2)+i},galleriaIn:function(t,e,i,n,a){return n*(e/=a)*e+i},galleriaOut:function(t,e,i,n,a){return-n*(e/=a)*(e-2)+i}}),t.fn.galleria=function(t){return this.each(function(){var e=new w;e.init(this,t)})},i.Galleria=w}(jQuery);