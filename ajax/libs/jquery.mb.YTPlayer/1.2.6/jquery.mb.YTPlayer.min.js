function onYouTubePlayerReady(t){var e=$("#"+t);e.mb_setMovie()}function playerState(t,e){var a=$("#"+e).get(0),i=$("#"+a.id+"_data").get(0);0==t&&i.isBgndMovie&&a.playVideo(),-1!=t&&3!=t||!i.isBgndMovie||($(a).css({opacity:0}),$(".mbYTP_raster").css({opacity:.5,backgroundColor:"black"}).fadeIn(),$(".mbYTP_bufferImg").css({opacity:.2}).fadeIn(),$.browser.msie||$("#wrapper_"+a.id).css({opacity:0})),1==t&&i.isBgndMovie&&($(a).css({opacity:i.opacity}),$(".mbYTP_raster").css({opacity:1,backgroundColor:"transparent"}),$(".mbYTP_bufferImg").fadeOut(),$.browser.msie||$("#wrapper_"+a.id).animate({opacity:1},1e3)),1!=t||i.isBgndMovie||(a.totalBytes=a.getVideoBytesTotal()),0!=t||i.isBgndMovie||$(a).stopYTP()}!function(t){t.mbYTPlayer={name:"jquery.mb.YTPlayer",version:"1.2.6",author:"Matteo Bicocchi",width:450,controls:{play:"<img src='images/play.png'>",pause:"<img src='images/pause.png'>",mute:"<img src='images/mute.png'>",unmute:"<img src='images/unmute.png'>"},rasterImg:"images/raster.png",setYTPlayer:function(){var e=this;t.getScript("http://ajax.googleapis.com/ajax/libs/swfobject/2/swfobject.js",function(){e.each(function(){if(t(this).is("a")){t(this).attr("id")||t(this).attr("id","YTP_"+(new Date).getTime());var e=t(this).attr("id"),a=t("<span/>");a.attr("id",e+"_data").hide();var i=a.get(0);i.opacity=1,i.isBgndMovie=!1,i.width=t.mbYTPlayer.width,i.quality="default",i.muteSound=!1,i.hasControls=!1,i.ratio="16/9",i.bufferImg=!1;var o="undefined"!=typeof document.YTPBG;t.metadata&&(t.metadata.setType("class"),t(this).metadata().quality&&(i.quality=t(this).metadata().quality),t(this).metadata().width&&(i.width=t(this).metadata().width),t(this).metadata().opacity&&(i.opacity=t(this).metadata().opacity),t(this).metadata().isBgndMovie&&!o&&(i.isBgndMovie=t(this).metadata().isBgndMovie,i.width=t(this).metadata().isBgndMovie.width?t(this).metadata().isBgndMovie.width:"window"),t(this).metadata().muteSound&&(i.muteSound=t(this).metadata().muteSound),t(this).metadata().hasControls&&(i.hasControls=t(this).metadata().hasControls),t(this).metadata().ratio&&(i.ratio=t(this).metadata().ratio),t(this).metadata().bufferImg&&(i.bufferImg=t(this).metadata().bufferImg),t(this).metadata().ID&&(i.ID=t(this).metadata().ID));var s=t(i.ID?"#"+i.ID:"body");"window"==i.width?(i.height="100%",i.width="100%",i.ID&&(i.height=s.outerHeight()+40,i.width=s.outerWidth())):i.height=Math.ceil("16/9"==i.ratio?9*i.width/16:3*i.width/4);var r="";if(t(s).append(a),i.isBgndMovie){if(t.browser.msie&&t.browser.version<8||i.ID){var n=t("<div/>").css({position:"relative",zIndex:0});t(s).wrapInner(n),t(s).prepend(t(this))}else t(s).css({position:"relative",zIndex:1}),t(s).before(t(this));var d=i.ID?"absolute":"fixed";if(r=t("<div/>").attr("id","wrapper_"+e).css({overflow:"hidden",position:d,left:0,top:0,width:"100%",height:"100%"}),t(this).wrap(r),-1==!i.width.toString().indexOf("%")){var m=t("<div/>").css({position:d,top:"4/3"!=i.ratio||i.ID?0:-(i.height/4),left:0,display:"block",width:i.width,height:i.height});t(this).wrap(m)}}else r=t("<span/>").attr("id","wrapper_"+e).css({width:i.width,height:i.height,position:"relative"}).addClass("mb_YTVPlayer"),t(this).wrap(r);var l={allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"true"},u={id:e};i.movieURL=t(this).attr("href").match(/[\\?&]v=([^&#]*)/)[1],swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid="+e,e,i.width,i.height,"8",null,null,l,u)}})})},setMovie:function(){var e=t(this).get(0),a=t("#"+e.id+"_data").get(0),i="undefined"!=typeof document.YTPBG,o=a.movieURL;t(e).css({opacity:a.opacity});var s=a.ID?"absolute":"fixed",r=a.bufferImg?t("<div/>").addClass("mbYTP_bufferImg").css({position:s,top:0,left:0,width:"100%",height:"100%",background:"url("+a.bufferImg+")"}).hide():!1,n=t(e).parents("div:first"),d=t("<div/>").addClass("mbYTP_raster").css({position:s,top:0,left:0,width:"100%",height:"100%",background:"url("+t.mbYTPlayer.rasterImg+")"}).hide();a.bufferImg&&t(n).after(r),a.isBgndMovie&&!i?(t.mbYTPlayer.rasterImg&&0==t("mbYTP_raster").length&&t(n).append(d),a.ID||(document.YTPBG=!0),e.loadVideoByUrl("http://www.youtube.com/v/"+o,0),a.isBgndMovie.mute&&e.mute()):(t(n).after(r),e.cueVideoByUrl("http://www.youtube.com/v/"+o,0),t(e).buildYTPControls()),e.addEventListener("onStateChange",'(function(state) { return playerState(state, "'+e.id+'"); })')},changeMovie:function(e){var a=t(this).get(0),i=t("#"+a.id+"_data").get(0);i.movieURL=e.match(/[\\?&]v=([^&#]*)/)[1],a.loadVideoByUrl("http://www.youtube.com/v/"+i.movieURL,0)},getPlayer:function(){return this.get(0)},playYTP:function(){var e=t(this).get(0),a=t(e).parent().find(".mb_YTVPPlaypause");a.html(t.mbYTPlayer.controls.pause),e.playVideo()},stopYTP:function(){var e=t(this).get(0),a=t(e).parent().find(".mb_YTVPPlaypause");a.html(t.mbYTPlayer.controls.play),e.pauseVideo()},pauseYTP:function(){var e=t(this).get(0),a=t(e).parent().find(".mb_YTVPPlaypause");a.html(t.mbYTPlayer.controls.play),e.pauseVideo()},setYTPVolume:function(e){{var a=t(this).get(0);t(a).parent().find(".mb_YTVPVolume")}a.setVolume(e)},muteYTPVolume:function(){var e=t(this).get(0),a=t(e).parent().find(".mb_YTVPMuteUnmute");a.html(t.mbYTPlayer.controls.unmute),e.mute()},unmuteYTPVolume:function(){var e=t(this).get(0),a=t(e).parent().find(".mb_YTVPMuteUnmute");a.html(t.mbYTPlayer.controls.mute),e.unMute()},manageYTPProgress:function(){var e=t(this).get(0),a=t(e).parent(".mb_YTVPlayer"),i=a.find(".mb_YTVPProgress"),o=a.find(".mb_YTVPLoaded"),s=a.find(".mb_YTVTime"),r=i.outerWidth(),n=e.getVideoStartBytes(),d=e.getVideoBytesTotal(),m=e.getVideoBytesLoaded(),l=Math.floor(e.getCurrentTime()),u=Math.floor(e.getDuration()),h=l*r/u,p=0;n&&(p=e.timeW);var c=m*(r-p)/d;return o.css({left:p,width:c}),s.css({left:0,width:h}),{totalTime:u,currentTime:l}},buildYTPControls:function(){var e=t(this).get(0);if("undefined"==typeof e.isInit){e.isInit=!0;var a=t(this).parent(".mb_YTVPlayer"),i=t("<span/>").addClass("mb_YTVPBar").css({whiteSpace:"noWrap",position:"absolute"}).hide(),o=t("<span>"+t.mbYTPlayer.controls.play+"</span>").addClass("mb_YTVPPlaypause").click(function(){1==e.getPlayerState()?t(e).pauseYTP():t(e).playYTP()}),s=t("<span>"+t.mbYTPlayer.controls.mute+"</span>").addClass("mb_YTVPMuteUnmute").click(function(){e.isMuted()?t(e).unmuteYTPVolume():t(e).muteYTPVolume()}),r=t("<span/>").addClass("mb_YTVPTime"),n=t("<div/>").addClass("mb_YTVPProgress").css("position","absolute").click(function(t){m.css({width:t.clientX-m.offset().left}),e.timeW=t.clientX-m.offset().left,a.find(".mb_YTVPLoaded").css({width:0});var i=Math.floor(e.getDuration());e.goto=m.outerWidth()*i/n.outerWidth(),e.seekTo(e.goto,!0),a.find(".mb_YTVPLoaded").css({width:0})}),d=t("<div/>").addClass("mb_YTVPLoaded").css("position","absolute"),m=t("<div/>").addClass("mb_YTVTime").css("position","absolute");n.append(d).append(m),i.append(o).append(s).append(r).append(n),a.append(i),a.hover(function(){i.fadeIn(),clearInterval(e.getState),e.getState=setInterval(function(){var i=t(e).manageYTPProgress();t(".mb_YTVPTime").html(t.mbYTPlayer.formatTime(i.currentTime)+" / "+t.mbYTPlayer.formatTime(i.totalTime)),1==e.getPlayerState()&&t(".mb_YTVPPlaypause").html()!=t.mbYTPlayer.controls.pause&&a.find(".mb_YTVPPlaypause").html(t.mbYTPlayer.controls.pause),2==e.getPlayerState()&&a.find(".mb_YTVPPlaypause").html(t.mbYTPlayer.controls.play)},500)},function(){i.fadeOut(),clearInterval(e.getState)})}},formatTime:function(t){var e=Math.floor(t/60),a=Math.floor(t-60*e);return(9>e?"0"+e:e)+" : "+(9>a?"0"+a:a)}},t.fn.mb_YTPlayer=t.mbYTPlayer.setYTPlayer,t.fn.mb_setMovie=t.mbYTPlayer.setMovie,t.fn.mb_changeMovie=t.mbYTPlayer.changeMovie,t.fn.getPlayer=t.mbYTPlayer.getPlayer,t.fn.buildYTPControls=t.mbYTPlayer.buildYTPControls,t.fn.playYTP=t.mbYTPlayer.playYTP,t.fn.stopYTP=t.mbYTPlayer.stopYTP,t.fn.pauseYTP=t.mbYTPlayer.pauseYTP,t.fn.muteYTPVolume=t.mbYTPlayer.muteYTPVolume,t.fn.unmuteYTPVolume=t.mbYTPlayer.unmuteYTPVolume,t.fn.manageYTPProgress=t.mbYTPlayer.manageYTPProgress,t.fn.changeMovie=function(e){var a=t(this).get(0),i=t("#"+a.id+"_data").get(0);i.movieURL=e.match(/[\\?&]v=([^&#]*)/)[1],a.loadVideoByUrl("http://www.youtube.com/v/"+i.movieURL,0)},t.fn.changeVolume=function(e){var a=t(this).get(0),i=t("#"+a.id+"_data").get(0);i.vol=e||i.vol||0!=a.getVolume()?!e&&a.getVolume()>0||e&&a.getVolume()==e?0:e:100,a.setVolume(i.vol)}}(jQuery);