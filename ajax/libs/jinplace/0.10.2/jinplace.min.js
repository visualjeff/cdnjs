!function(t,e,n,i){function a(e,n){var i=this.element=t(e);n&&t.each(c,function(t,e){var i=e[0];n[i]=n[i]||n[e[1]]});var a=this.elementOptions(i),r=a.activator||e;a.activator=t(r);var l=t.extend({},t.fn[o].defaults,n,a);this.opts=l,this.bindElement(l)}var o="jinplace",r=["type","url","data","loadurl","object","attribute","okButton","cancelButton","inputClass","activator","textOnly","placeholder"],c=[["placeholder","nil"]];a.prototype={elementOptions:function(e){function n(t){return"-"+t.toLowerCase()}function i(t){return"data-"+t.replace(/[A-Z]/g,n)}var a={};return t.each(r,function(t,n){a[n]=e.attr(i(n))}),t.each(c,function(t,n){var o=n[0];a[o]=a[o]||e.attr(i(n[1]))}),a.textOnly&&(a.textOnly="false"!==a.textOnly),a},bindElement:function(e){e.activator.off("click.jip").on("click.jip",t.proxy(this.clickHandler,this));var n=this.element;""==t.trim(n.html())&&n.html(e.placeholder)},clickHandler:function(e){e.preventDefault(),e.stopPropagation(),t(e.currentTarget).off("click.jip").on("click.jip",function(t){t.preventDefault()});var n=this,a=n.opts,r=t.extend({},s,t.fn[o].editors[a.type]);n.origValue=n.element.html(),n.fetchData(a).done(function(t){var e=r.makeField(n.element,t);r.inputField||(r.inputField=e),e.addClass(a.inputClass);var o=l(a,e,r.buttonsAllowed);n.element.html(o),o.on("jip:submit submit",function(){return n.submit(r,a),!1}).on("jip:cancel",function(){return n.cancel(r),!1}).on("keyup",function(t){27==t.keyCode&&n.cancel(r)}),r.activate(o,e);var c=r.blurAction||(a.okButton?a.cancelButton?i:"jip:cancel":"submit");r.blurEvent(e,o,c)})},requestParams:function(e,n){var a=this,o={id:a.element.id,object:e.object,attribute:e.attribute};return t.isPlainObject(n)?t.extend(o,n):n!==i&&(o.value=n),o},fetchData:function(e){var n,a=this;n=e.data?e.data:e.loadurl?t.ajax(e.loadurl,{data:this.requestParams(e,i),context:a}):t.trim(this.element.html());var o=function(t){return t==e.placeholder?"":t},r=t.when(n);return r.pipe?r.pipe(o):r.then(o)},cancel:function(t){var e=this;e.element.html(e.origValue),t.finish(),e.bindElement(e.opts)},submit:function(e,n){var i=this;t.ajax(n.url,{type:"post",data:i.requestParams(n,e.value()),dataType:"text",context:i,headers:{"Cache-Control":"no-cache"}}).done(function(t){this.onUpdate(e,n,t)}).fail(function(){this.cancel(e)})},onUpdate:function(t,e,n){var i=this;i.setContent(t.displayValue(n)),t.finish(),i.bindElement(e)},setContent:function(t){var e=this.element;t||(t=this.opts.placeholder),this.opts.textOnly?e.text(t):e.html(t)}},t.fn[o]=function(e){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new a(this,e))})},t.fn[o].defaults={url:n.location.pathname,type:"input",textOnly:2,placeholder:"[ --- ]"};var l=function(e,n,i){var a=t("<form>").attr("style","display: inline;").attr("action","javascript:void(0);").append(n);return i&&u(a,e),a},u=function(e,n){var i=function(t,n){e.append(t),t.one("click",function(t){t.stopPropagation(),e.trigger(n)})},a=n.okButton;if(a){var o=t("<input>").attr("type","button").attr("value",a).addClass("jip-button jip-ok-button");i(o,"submit")}var r=n.cancelButton;r&&(o=t("<input>").attr("type","button").attr("value",r).addClass("jip-button jip-cancel-button"),i(o,"jip:cancel"))},s={makeField:function(e,n){return t("<input>").attr("type","text").val(n)},activate:function(t,e){e.focus()},value:function(){return this.inputField.val()},displayValue:function(t){return t},blurEvent:function(t,e,n){if(n&&"ignore"!=n){var i=function(){var i=setTimeout(function(){t.trigger(n)},300);e.on("click",function(){clearTimeout(i)})};t.on("blur",i)}},finish:function(){}};t.fn[o].editorBase=s,t.fn[o].editors={input:{buttonsAllowed:!0},textarea:{buttonsAllowed:!0,makeField:function(e,n){var i=t("<textarea>").css({"min-width":e.width(),"min-height":e.height()}).val(n);return i.elastic&&i.elastic(),i}},select:{makeField:function(e,n){var i=t("<select>"),a=t.parseJSON(n),o=!1,r=null;return t.each(a,function(n,a){var c=t("<option>").val(a[0]).html(a[1]);a[2]&&(c.attr("selected","1"),o=!0),a[1]==e.text()&&(r=c),i.append(c)}),!o&&r&&r.attr("selected","1"),this.choices=a,i},activate:function(t,e){e.focus(),e.on("change",function(){e.trigger("jip:submit")})},displayValue:function(e){var n="";return t.each(this.choices,function(t,i){return e==i[0]?(n=i[1],!1):!0}),n}}}}(jQuery,window,document);