var CirclePlayer=function(s,e,t){var r=this,i={supplied:"m4a, oga",cssSelectorAncestor:"#cp_container_1",cssSelector:{play:".cp-play",pause:".cp-pause"}},a={bufferHolder:".cp-buffer-holder",buffer1:".cp-buffer-1",buffer2:".cp-buffer-2",progressHolder:".cp-progress-holder",progress1:".cp-progress-1",progress2:".cp-progress-2",circleControl:".cp-circle-control"};this.cssClass={gt50:"cp-gt50",fallback:"cp-fallback"},this.spritePitch=104,this.spriteRatio=.24,this.player=$(s),this.media=$.extend({},e),this.options=$.extend(!0,{},i,t),this.cssTransforms=Modernizr.csstransforms,this.audio={},this.dragging=!1,this.eventNamespace=".CirclePlayer",this.jq={},$.each(a,function(s,e){r.jq[s]=$(r.options.cssSelectorAncestor+" "+e)}),this._initSolution(),this._initPlayer()};CirclePlayer.prototype={_createHtml:function(){},_initPlayer:function(){var s=this;this.player.jPlayer(this.options),this.player.bind($.jPlayer.event.ready+this.eventNamespace,function(e){e.jPlayer.html.used&&e.jPlayer.html.audio.available&&(s.audio=$(this).data("jPlayer").htmlElement.audio),$(this).jPlayer("setMedia",s.media),s._initCircleControl()}),this.player.bind($.jPlayer.event.play+this.eventNamespace,function(){$(this).jPlayer("pauseOthers")}),this.player.bind($.jPlayer.event.timeupdate+this.eventNamespace,function(e){s.dragging||s._timeupdate(e.jPlayer.status.currentPercentAbsolute)}),this.player.bind($.jPlayer.event.progress+this.eventNamespace,function(){var e=0;if("object"==typeof s.audio.buffered&&s.audio.buffered.length>0){if(s.audio.duration>0){for(var t=0,r=0;r<s.audio.buffered.length;r++)t+=s.audio.buffered.end(r)-s.audio.buffered.start(r);e=100*t/s.audio.duration}}else e=0;s._progress(e)}),this.player.bind($.jPlayer.event.ended+this.eventNamespace,function(){s._resetSolution()})},_initSolution:function(){this.cssTransforms?(this.jq.progressHolder.show(),this.jq.bufferHolder.show()):(this.jq.progressHolder.addClass(this.cssClass.gt50).show(),this.jq.progress1.addClass(this.cssClass.fallback),this.jq.progress2.hide(),this.jq.bufferHolder.hide()),this._resetSolution()},_resetSolution:function(){this.cssTransforms?(this.jq.progressHolder.removeClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate(0deg)"}),this.jq.progress2.css({transform:"rotate(0deg)"}).hide()):this.jq.progress1.css("background-position","0 "+this.spritePitch+"px")},_initCircleControl:function(){var s=this;this.jq.circleControl.grab({onstart:function(){s.dragging=!0},onmove:function(e){var t=s._getArcPercent(e.position.x,e.position.y);s.player.jPlayer("playHead",t).jPlayer("play"),s._timeupdate(t)},onfinish:function(e){s.dragging=!1;var t=s._getArcPercent(e.position.x,e.position.y);s.player.jPlayer("playHead",t).jPlayer("play")}})},_timeupdate:function(s){var e=3.6*s+"deg",t=(Math.floor(Math.round(s)*this.spriteRatio)-1)*-this.spritePitch;50>=s?this.cssTransforms?(this.jq.progressHolder.removeClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate("+e+")"}),this.jq.progress2.hide()):this.jq.progress1.css("background-position","0 "+t+"px"):100>=s&&(this.cssTransforms?(this.jq.progressHolder.addClass(this.cssClass.gt50),this.jq.progress1.css({transform:"rotate(180deg)"}),this.jq.progress2.css({transform:"rotate("+e+")"}),this.jq.progress2.show()):this.jq.progress1.css("background-position","0 "+t+"px"))},_progress:function(s){var e=3.6*s+"deg";this.cssTransforms&&(50>=s?(this.jq.bufferHolder.removeClass(this.cssClass.gt50),this.jq.buffer1.css({transform:"rotate("+e+")"}),this.jq.buffer2.hide()):100>=s&&(this.jq.bufferHolder.addClass(this.cssClass.gt50),this.jq.buffer1.css({transform:"rotate(180deg)"}),this.jq.buffer2.show(),this.jq.buffer2.css({transform:"rotate("+e+")"})))},_getArcPercent:function(s,e){var t=this.jq.circleControl.offset(),r=s-t.left-this.jq.circleControl.width()/2,i=e-t.top-this.jq.circleControl.height()/2,a=Math.atan2(i,r);return a>-1*Math.PI&&a<-.5*Math.PI&&(a=2*Math.PI+a),(a+Math.PI/2)/2*Math.PI*10},setMedia:function(s){this.media=$.extend({},s),this.player.jPlayer("setMedia",this.media)},play:function(s){this.player.jPlayer("play",s)},pause:function(s){this.player.jPlayer("pause",s)},destroy:function(){this.player.unbind(this.eventNamespace),this.player.jPlayer("destroy")}};